import{j as Q,h as U,bw as j,bz as H,E as Y,p,o as b,q as Z,G as N,I as ee,m as F,H as D,bA as M,O as V,P as q,V as te,D as ie,l as P,n as z,s as K,a2 as se,bB as ae,bC as ne,bD as le,bE as oe,bF as ce,bG as re}from"./index-Do0CBbdm.js";import{b as W}from"./format-BFOA4BKc.js";import{_ as $}from"./MyButton.vue_vue_type_script_setup_true_lang-0geFim1q.js";const ue=["innerHTML"],pe=Q({__name:"TextParts",props:{text:{},html:{type:Boolean,default:!1},defaultSize:{default:1450},defaultLines:{default:25},lineCharacters:{default:58}},setup(S){const t=S,e=/(<[^>]+>|[^<]+)/g,I=/\/>$/,y=/^<br\s*\/?>/i,k=/^<hr\s*\/?>/i,g=/^<\/(\w+)>/,C=/^<(\w+)/,E=/\n/g,G=/<br\s*\/?>|<hr\s*\/?>/gi,w=/<[^>]*>/g;function B(c,l,u){const o=j(c+l+u);if(M.has(o))return M.get(o);const f=c.match(e)||[],i=[];let s="",r=0,n=0,v=0;const m=[],d=()=>m.slice().reverse().map(a=>`</${a}>`).join(""),A=()=>m.map(a=>`<${a}>`).join("");for(const a of f)if(a.startsWith("<")){if(s+=a,(y.test(a)||k.test(a))&&(n++,v=0,n>=u&&(i.push(s+d()),s=A(),r=0,n=0,v=0)),!(I.test(a)||y.test(a)||k.test(a))){if(g.test(a)){const _=a.match(g);if(_){const X=_[1],h=m.lastIndexOf(X);h!==-1&&m.splice(h,1)}}else if(C.test(a)){const _=a.match(C);_&&m.push(_[1])}}}else{let T=a;for(;T.length>0;){const _=l-r,X=t.lineCharacters-v,h=Math.min(_,X,T.length),J=T.slice(0,h);s+=J,r+=h,v+=h,T=T.slice(h),v>=t.lineCharacters&&(n++,v=0,n>=u&&(i.push(s+d()),s=A(),r=0,n=0,v=0)),r===l&&(i.push(s+d()),s=A(),r=0,v=0,n=0)}}return s&&i.push(s+d()),M.put(o,i),i}function x(c,l,u){const o=[];let f="",i=0,s=0,r=0,n=0;for(;n<c.length;){const v=l-i,m=t.lineCharacters-r,d=c.indexOf(`
`,n),A=d!==-1?d-n+1:1/0,a=Math.min(v,m,A,c.length-n);f+=c.slice(n,n+a),i+=a,r+=a,n+=a,d!==-1&&d<n&&(s++,r=0),r>=t.lineCharacters&&(s++,r=0),(i===l||s===u)&&(o.push(f),f="",i=0,s=0,r=0)}return f&&o.push(f),o}const L=U(()=>{if(!t.text)return[];const c=j(t.text+t.html+t.defaultSize+t.defaultLines+t.lineCharacters);let l;if(H.has(c))l=H.get(c);else if(t.html){const u=(t.text.match(G)||[]).length,o=t.text.replace(w,""),f=Math.floor(o.length/t.lineCharacters);l=u+f}else{const u=(t.text.match(E)||[]).length,o=Math.floor(t.text.length/t.lineCharacters);l=u+o}return H.put(c,l),t.text.length<t.defaultSize&&l<t.defaultLines?[t.text]:t.html?B(t.text,t.defaultSize,t.defaultLines):x(t.text,t.defaultSize,t.defaultLines)}),R=Y(0);function O(){R.value++}return(c,l)=>(b(),p("span",null,[(b(!0),p(N,null,ee(L.value,(u,o)=>(b(),p(N,{key:o},[t.html?V((b(),p("span",{key:0,innerHTML:u},null,8,ue)),[[q,o<=R.value]]):V((b(),p("span",{key:1},D(u),513)),[[q,o<=R.value]])],64))),128)),R.value<L.value.length-1?(b(),p(N,{key:0},[l[0]||(l[0]=F("span",null,"...",-1)),F("button",{class:"more-btn",onClick:O},D(c.$t("more")),1)],64)):Z("",!0)]))}}),fe={class:"action-container"},ve={class:"action-container"},de={class:"action-container circle"},be=Q({__name:"ReactionButtons",props:{object:{},beforeAction:{type:Function},isComment:{type:Boolean},disable:{type:Boolean}},setup(S){const t=S,e=te(t.object),I=se(),{t:y}=ie();let k=null,g=e.value.is_fav,C=null,E=e.value.is_like,G=[e.value.likes_count,e.value.dislikes_count],w=!1;function B(i,s){C!==null&&clearTimeout(C),C=setTimeout(i,s)}function x(i,s){w||(E=i,G=s)}function L(i){const{is_like:s,likes_count:r,dislikes_count:n}=e.value;x(s,[r,n]),w=!0,R(i),B(()=>void c(i),500)}function R(i){e.value.is_like===i?(e.value.is_like=void 0,i?e.value.likes_count--:e.value.dislikes_count--):(e.value.is_like!==void 0&&(i?e.value.dislikes_count--:e.value.likes_count--),i?e.value.likes_count++:e.value.dislikes_count++,e.value.is_like=i)}function O(){e.value.is_like!==E&&(e.value.is_like=E,e.value.likes_count=G[0],e.value.dislikes_count=G[1])}async function c(i){w=!1;try{if(e.value.is_like===E)return;e.value.is_like===void 0?await ce(e.value.post_id,e.value.comment_id):await re(e.value.post_id,{isLike:i,commentId:e.value.comment_id})}catch(s){O(),I.notify({type:"error-notification",message:y("reaction_failed"),progress:!0}),console.error(s)}}function l(){t.beforeAction&&t.beforeAction(),L(!0)}function u(){t.beforeAction&&t.beforeAction(),L(!1)}async function o(i){if(g!==i)try{i===!0?t.isComment?await ae(e.value.post_id,e.value.comment_id):await ne(e.value.post_id):t.isComment?await le(e.value.post_id,e.value.comment_id):await oe(e.value.post_id),g=i}catch(s){e.value.is_fav=g,I.notify({type:"error-notification",message:y("favorite_failed"),progress:!0}),console.error(s)}}function f(){t.beforeAction&&t.beforeAction(),k!==null&&clearTimeout(k);const i=!e.value.is_fav;k=setTimeout(()=>void o(i),500),e.value.is_fav=i}return(i,s)=>(b(),p(N,null,[F("div",fe,[P($,{icon:"thumb_up",label:K(W)(e.value.likes_count),class:z(["like round button",{active:e.value.is_like===!0}]),onClick:l,disable:i.disable},null,8,["label","class","disable"])]),F("div",ve,[P($,{icon:"thumb_down",label:K(W)(e.value.dislikes_count),class:z(["dislike round button",{active:e.value.is_like===!1}]),onClick:u,disable:i.disable},null,8,["label","class","disable"])]),F("div",de,[P($,{icon:"favorite",class:z(["favorite button circle",{active:e.value.is_fav}]),onClick:f,disable:i.disable},null,8,["class","disable"])])],64))}});export{pe as _,be as a};
