const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProfileCropper-DHCKteZY.js","assets/index-CW-_h3H6.js","assets/index-bp0Wj9ML.css","assets/MyButton.vue_vue_type_script_setup_true_lang-aOd0h3La.js","assets/ProfileCropper-Bakm0czn.css","assets/MySpinner-aqX1XRWk.js"])))=>i.map(i=>d[i]);
import{j as ce,D as de,a2 as ve,u as pe,E as d,h as X,F as be,X as fe,k as A,p as S,o as h,w as R,m as n,q as D,l as o,H as $,Y as M,aN as me,G as _e,I as ge,Z as he,Q as ye,s as Y,t as H,_ as Z,a7 as J}from"./index-CW-_h3H6.js";import{Q as ke}from"./QMenu-Bmlm-oOs.js";import{Q as $e}from"./QScrollArea-BfWxh7rm.js";import{u as we}from"./profile-store-DmI2gycK.js";import{a as C,_ as y}from"./MyButton.vue_vue_type_script_setup_true_lang-aOd0h3La.js";import{_ as W}from"./MyChip.vue_vue_type_script_setup_true_lang-DpPNh9Tl.js";import"./QScrollObserver-B0ZGY-Hj.js";const Ue={class:"card container profile-container"},Ve={class:"horizontal-container"},Re={class:"label"},Ce={class:"card languages"},Le={class:"horizontal-container"},Pe={class:"label"},ze={class:"chips"},Ae={class:"card change-avatar"},Se={class:"horizontal-container"},De={class:"label"},Ee={key:0,class:"horizontal-container image-state card"},Ie={class:"image-state-label"},Qe={class:"horizontal-container"},Me={class:"card change-banner"},Oe={class:"horizontal-container"},je={class:"label"},Ne={key:0,class:"horizontal-container image-state card"},Be={class:"image-state-label"},qe={class:"horizontal-container"},Fe={class:"horizontal-container button-container"},Ge={class:"dialog-content"},Te={class:"title"},Ke={key:1,class:"loading-container"},x=8,aa=ce({__name:"AccountView",setup(Xe){const ee=H(()=>Z(()=>import("./ProfileCropper-DHCKteZY.js"),__vite__mapDeps([0,1,2,3,4]))),ae=H(()=>Z(()=>import("./MySpinner-aqX1XRWk.js"),__vite__mapDeps([5,1,2]))),O={set:"check",not_set:"block",changed:"edit",removed:"delete"},{t:E}=de(),j=ve(),le=pe(),L=we(),i=d(L.profile),te=d(null),s=d({if:!1,show:!1,aspectRatio:1,img:"",type:""}),P=[];let f={},I;const u=d({avatar:"not_set",banner:"not_set"}),_=d(""),g=d(""),U=d(""),V=d(""),k=d(""),m=d([]),c=d(!1),N=d(!1),z=X(()=>{var e,a,t,l,r,p,v;return{...U.value!==((e=i.value)==null?void 0:e.display_name)&&{display_name:U.value},...V.value!==((a=i.value)==null?void 0:a.bio)&&{bio:V.value},...!oe(m.value,(t=i.value)==null?void 0:t.languages)&&{languages:m.value},..._.value!==((r=(l=i.value)==null?void 0:l.banner_url)!=null?r:"")&&{banner_url:_.value},...g.value!==((v=(p=i.value)==null?void 0:p.avatar_url)!=null?v:"")&&{avatar_url:g.value}}}),ne=X(()=>({...i.value,...z.value}));function B(){for(const e of P)URL.revokeObjectURL(e);P.length=0}function oe(e,a){if(!e||!a||e.length!==a.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==a[t])return!1;return!0}function q(e){const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=()=>{if(!a.files)return;const t=a.files[0];if(t){const l=URL.createObjectURL(t);s.value.img=l,s.value.aspectRatio=e=="avatar"?1:11/3,s.value.show=!0,s.value.if=!0,s.value.type=e,P.push(l)}},a.click()}function F(){s.value.show=!1,setTimeout(()=>{s.value.show||(s.value.if=!1)},300)}function G(e){e=="avatar"?(g.value="",u.value.avatar="removed"):(_.value="",u.value.banner="removed"),I.push(e),f[e]=void 0}function se(e){const a=URL.createObjectURL(e),t=s.value.type;f[t]={blob:e,filename:`${crypto.randomUUID()}.webp`},t=="avatar"?(u.value.avatar="changed",g.value=a):(u.value.banner="changed",_.value=a),P.push(a),F()}function T(){k.value&&!m.value.includes(k.value)&&(m.value.push(k.value),k.value="")}function ie(e){m.value.splice(e,1)}async function re(){var e,a,t,l;c.value=!0;try{_.value=(a=(e=i.value)==null?void 0:e.banner_url)!=null?a:"",g.value=(l=(t=i.value)==null?void 0:t.avatar_url)!=null?l:"";let r,p;const v={...z.value};for(const b of I)b=="avatar"?(v.avatar_context_id=null,r=""):(v.banner_context_id=null,p="");const w=[];f.avatar&&w.push(J(f.avatar.filename,f.avatar.blob,"avatar").then(b=>{r=b.data.data.file_url,v.avatar_context_id=b.data.data.context_id})),f.banner&&w.push(J(f.banner.filename,f.banner.blob,"banner").then(b=>{p=b.data.data.file_url,v.banner_context_id=b.data.data.context_id})),await Promise.all(w),await L.updateProfile(v,r,p),i.value=L.profile,j.notify({type:"default-notification",message:E("profile_updated.msg"),caption:E("profile_updated.caption"),progress:!0,icon:"sym_r_done_outline"})}catch(r){throw j.notify({type:"error-notification",message:E("profile_updated.failed"),progress:!0}),r}finally{c.value=!1,Q()}}function ue(){le.openDialog("user","preview",{user:ne.value,notSync:!0})}async function Q(){var e,a,t,l,r,p,v,w,b,K;await L.getProfile(),U.value=(a=(e=i.value)==null?void 0:e.display_name)!=null?a:"",V.value=(l=(t=i.value)==null?void 0:t.bio)!=null?l:"",m.value=[...(p=(r=i.value)==null?void 0:r.languages)!=null?p:[]],_.value=(w=(v=i.value)==null?void 0:v.banner_url)!=null?w:"",g.value=(K=(b=i.value)==null?void 0:b.avatar_url)!=null?K:"",N.value=!0,f={},I=[],g.value&&(u.value.avatar="set"),_.value&&(u.value.banner="set"),B()}return be(Q),fe(()=>{B()}),(e,a)=>N.value?(h(),A($e,{key:0,class:"scroll-area fix-scroll-area full-height account-view",visible:!1},{default:R(()=>{var t;return[n("div",Ue,[n("div",Ve,[o(C,{icon:"account_circle",class:"label-icon",style:{transform:"translateY(-2px)"}}),n("div",Re,$(e.$t("profile")),1)]),o(M,{borderless:"",modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=l=>U.value=l),label:e.$t("display_name"),maxlength:"16",placeholder:(t=i.value)==null?void 0:t.username,class:"input",disable:c.value},null,8,["modelValue","label","placeholder","disable"]),o(M,{borderless:"",modelValue:V.value,"onUpdate:modelValue":a[1]||(a[1]=l=>V.value=l),label:e.$t("about_me"),maxlength:"512",autogrow:"",class:"input",ref_key:"aboutMeRef",ref:te,disable:c.value},null,8,["modelValue","label","disable"]),n("div",Ce,[n("div",Le,[o(me,{name:"sym_r_language",class:"label-icon"}),n("div",Pe,$(e.$t("languages")),1)]),n("div",ze,[(h(!0),S(_e,null,ge(m.value,(l,r)=>(h(),A(W,{key:r,removable:!0,onRemove:p=>ie(r),class:"language",label:l,disable:c.value},null,8,["onRemove","label","disable"]))),128)),o(W,{clickable:"",label:e.$t("add_language"),icon:"add",class:"language",disable:m.value.length>=x||c.value},{default:R(()=>[m.value.length<x?(h(),A(ke,{key:0,class:"menu-card enter-language-menu field-menu"},{default:R(()=>[o(M,{modelValue:k.value,"onUpdate:modelValue":a[2]||(a[2]=l=>k.value=l),label:e.$t("enter_language"),onKeyup:he(T,["enter"]),borderless:"",class:"language-input full-width",maxlength:"16"},{append:R(()=>[o(y,{icon:"add",class:"add-button",onClick:T,disable:k.value.length==0},null,8,["disable"])]),_:1},8,["modelValue","label"])]),_:1})):D("",!0)]),_:1},8,["label","disable"])])]),n("div",Ae,[n("div",Se,[o(C,{icon:"account_box",class:"label-icon"}),n("div",De,$(e.$t("avatar")),1)]),u.value.avatar?(h(),S("div",Ee,[o(C,{icon:O[u.value.avatar]},null,8,["icon"]),n("div",Ie,$(e.$t(u.value.avatar)),1)])):D("",!0),n("div",Qe,[o(y,{type:"primary",label:e.$t("change_avatar"),onClick:a[3]||(a[3]=l=>q("avatar")),disable:c.value},null,8,["label","disable"]),o(y,{type:"outlined",label:e.$t("remove_avatar"),disable:c.value||!g.value,onClick:a[4]||(a[4]=l=>G("avatar"))},null,8,["label","disable"])])]),n("div",Me,[n("div",Oe,[o(C,{icon:"image",class:"label-icon"}),n("div",je,$(e.$t("banner")),1)]),u.value.banner?(h(),S("div",Ne,[o(C,{icon:O[u.value.banner]},null,8,["icon"]),n("div",Be,$(e.$t(u.value.banner)),1)])):D("",!0),n("div",qe,[o(y,{type:"primary",label:e.$t("change_banner"),onClick:a[5]||(a[5]=l=>q("banner")),disable:c.value},null,8,["label","disable"]),o(y,{type:"outlined",label:e.$t("remove_banner"),disable:c.value||!_.value,onClick:a[6]||(a[6]=l=>G("banner"))},null,8,["label","disable"])])]),n("div",Fe,[o(y,{type:"outlined",class:"preview-button",label:e.$t("preview"),onClick:ue,"icon-right":"visibility"},null,8,["label"]),o(y,{type:"outlined",class:"cancel-button",label:e.$t("cancel"),onClick:Q,disable:Object.keys(z.value).length===0||c.value,"icon-right":"cancel"},null,8,["label","disable"]),o(y,{type:"primary",class:"save-button",label:e.$t("apply"),onClick:re,disable:Object.keys(z.value).length===0,"icon-right":"check",loading:c.value},null,8,["label","disable","loading"])])]),s.value.if?(h(),A(ye,{key:0,modelValue:s.value.show,"onUpdate:modelValue":a[7]||(a[7]=l=>s.value.show=l),"transition-show":"scale","transition-hide":"scale",class:"cropper-dialog card-dialog",maximized:""},{default:R(()=>[n("div",Ge,[n("div",Te,$(e.$t("crop_image")),1),n("div",null,[o(Y(ee),{img:s.value.img,"aspect-ratio":s.value.aspectRatio,"is-circle":s.value.type=="avatar","target-width":s.value.type=="avatar"?256:624,"target-height":s.value.type=="avatar"?256:170,onDismiss:F,onApply:se},null,8,["img","aspect-ratio","is-circle","target-width","target-height"])])])]),_:1},8,["modelValue"])):D("",!0)]}),_:1})):(h(),S("div",Ke,[o(Y(ae),{size:"55px",color:"primary"})]))}});export{aa as default};
