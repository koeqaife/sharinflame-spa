const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CommentComponent-t9q2FPfs.js","assets/CommentComponent.vue_vue_type_script_setup_true_lang-Bp1Fjw5N.js","assets/index-CW-_h3H6.js","assets/index-bp0Wj9ML.css","assets/QSpace-BLX8xWL2.js","assets/QMenu-Bmlm-oOs.js","assets/QScrollArea-BfWxh7rm.js","assets/QScrollObserver-B0ZGY-Hj.js","assets/format-CjHWdibf.js","assets/ReactionButtons.vue_vue_type_script_setup_true_lang-BiShpF7h.js","assets/MyButton.vue_vue_type_script_setup_true_lang-aOd0h3La.js","assets/i18n-CgE_7Bs0.js","assets/UserAvatar-CDRQ9fRO.js","assets/UserAvatar.vue_vue_type_script_setup_true_lang-gHrAtUti.js","assets/profile-store-DmI2gycK.js"])))=>i.map(i=>d[i]);
import{j as le,V as ne,E as n,h as ie,W as T,F as re,X as de,k as S,o as v,w as f,l as a,s as _,m as i,H as ue,q as L,p as U,n as N,t as O,R as me,Y as ce,Z as pe,Q as ve,_ as W,$ as P,a0 as fe,a1 as _e}from"./index-CW-_h3H6.js";import{Q as j}from"./QSpace-BLX8xWL2.js";import{Q as he}from"./QScrollArea-BfWxh7rm.js";import{_ as ge}from"./PostComponent.vue_vue_type_script_setup_true_lang-B2KNN0hS.js";import{_ as ye}from"./CloseableContent.vue_vue_type_script_setup_true_lang-CSTaD23l.js";import{_ as be}from"./MyVirtualScroll.vue_vue_type_script_setup_true_lang--lf3OY7K.js";import{u as F}from"./use-dialog-plugin-component-C0eY4yAd.js";import{u as Ce}from"./profile-store-DmI2gycK.js";import{a as ke,_ as D}from"./MyButton.vue_vue_type_script_setup_true_lang-aOd0h3La.js";import{_ as we}from"./MySelect.vue_vue_type_script_setup_true_lang-D3d6G_xz.js";import{_ as $e}from"./RectSkeleton.vue_vue_type_script_setup_true_lang-DcvU8W5z.js";import"./QScrollObserver-B0ZGY-Hj.js";import"./QMenu-Bmlm-oOs.js";import"./format-CjHWdibf.js";import"./i18n-CgE_7Bs0.js";import"./ReactionButtons.vue_vue_type_script_setup_true_lang-BiShpF7h.js";import"./MyChip.vue_vue_type_script_setup_true_lang-DpPNh9Tl.js";import"./CategoryButtons.vue_vue_type_script_setup_true_lang-CndfIUk0.js";import"./ClosePopup-DaR8jHqY.js";const De={class:"dialog-header",style:{"z-index":"2"}},Ve={class:"horizontal-container label-container"},xe={class:"dialog-content-inner"},Se={class:"card dialog-section q-mb-sm",style:{"z-index":"2"}},Le={class:"horizontal-container"},Pe={key:0,class:"load-more-container"},Re={key:1,class:"card send-comment"},ze={class:"card-section"},Ae={class:"horizontal-container align-end full-width"},Je=le({__name:"PostDialog",props:{post:{},firstComment:{},autoLoad:{type:Boolean,default:!0}},emits:[...F.emits],setup(X){var I,B,M;const Y=O(()=>W(()=>import("./CommentComponent-t9q2FPfs.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Z=O(()=>W(()=>import("./UserAvatar-CDRQ9fRO.js"),__vite__mapDeps([12,13,2,3,14]))),c=X,R=Ce(),r=ne(c.post),z=n(Date.now()),l=n([]),d=n([]),V=n(!0),A=n(null),h=n(null),g=n(c.autoLoad),u=n((B=(I=c.firstComment)==null?void 0:I.type)!=null?B:"comment"),E=ie(()=>{var e;return u.value=="comment"||u.value=="update"&&r.value.user_id==((e=R.profile)==null?void 0:e.user_id)}),G=[{key:"comment",labelKey:"comments",icon:"chat_bubble"},{key:"update",labelKey:"updates",icon:"update"}];T(u,()=>{K()});let Q=!0,x,y=new AbortController;const m=n(((M=r.value._meta)==null?void 0:M.text)||""),b=n(!1);T(m,()=>te("text",m.value));const{dialogRef:C,onDialogHide:J}=F();function q(){g.value=!0,P(()=>{var e;(e=h.value)==null||e.checkLoading()})}function ee(e){V.value=e.position.top<A.value.scrollHeight+66||e.direction=="up"}function K(){y.abort(),y=new AbortController,l.value=[],d.value=[],z.value=Date.now(),x=void 0,V.value=!0,g.value||q()}function te(e,t){var o;(o=r.value)._meta||(o._meta={}),r.value._meta[e]=t}async function oe(e,t){var k;const o=[];(k=d.value)!=null||(d.value=[]);try{if(d.value.length===0){const s=await fe(r.value.post_id,x,u.value,{signal:y.signal}),p=s.data.data.comments;if(Q=s.data.data.has_more,x=s.data.data.next_cursor,s.data.success){const w=s.data.data.users;d.value.push(...p.map($=>({...$,user:w[$.user_id]})))}}if(o.push(...d.value.splice(0,5)),o.length>0){const s=l.value;o.forEach(p=>{const w=s.findIndex($=>$.comment_id===p.comment_id);w!==-1?s[w]=p:s.push(p)}),l.value=s}t(!(Q||d.value.length>0))}catch(s){throw t(!0),s}}async function H(e){if(!(e instanceof KeyboardEvent&&e.shiftKey)){b.value=!0;try{const t=await _e(r.value.post_id,m.value,u.value);if(t.data.success){const o={...t.data.data,user:await R.getProfile()};l.value.unshift(o),m.value="",r.value.comments_count+=1}}finally{b.value=!1,P(()=>{var t;return(t=h.value)==null?void 0:t.updateShowedItems(1)})}}}function ae(){var e;(e=C.value)==null||e.hide()}function se(e){l.value=l.value.filter(t=>t.comment_id!==e),r.value.comments_count-=1,P(()=>{var t;return(t=h.value)==null?void 0:t.updateShowedItems()})}return re(()=>{c.firstComment&&l.value.push(c.firstComment)}),de(()=>{l.value=[],d.value=[],y.abort()}),(e,t)=>(v(),S(ve,{"transition-show":"slide-up","transition-hide":"slide-down",class:"post-dialog card-dialog",ref_key:"dialogRef",ref:C,onHide:_(J),maximized:"",key:e.post.post_id},{default:f(()=>[a(ye,{onHide:t[3]||(t[3]=o=>_(C).hide())},{default:f(()=>[i("div",De,[i("div",Ve,[a(ke,{icon:"article",class:"header-icon"}),i("div",null,ue(e.$t("post")),1),a(j),a(D,{icon:"close",onClick:t[0]||(t[0]=o=>_(C).hide())})])]),i("div",xe,[a(he,{class:"scroll-area fix-scroll-area",visible:!1},{default:f(()=>[i("div",{ref_key:"postComponentRef",ref:A},[a(ge,{post:r.value,"in-dialog":!0,onDeletePost:ae,style:{"z-index":"2"}},null,8,["post"])],512),i("div",{class:N(["sticky-label scroll-header q-pt-sm",{"is-visible":V.value}])},[i("div",Se,[i("div",Le,[a(we,{options:G,modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=o=>u.value=o)},null,8,["modelValue"]),a(j),a(D,{icon:"refresh",onClick:K})])])],2),(v(),S(be,{items:l.value,margins:8,"item-key":"comment_id",onLoadMore:oe,onScroll:ee,"infinite-load-type":g.value?"bottom":"none",key:z.value,class:"posts-infinite-scroll",ref_key:"virtualScroll",ref:h,"skeleton-height":126,"no-items-key":u.value=="comment"?e.$t("no_comments"):e.$t("no_updates")},{default:f(({item:o,index:k})=>[a(_(Y),{comment:o,class:N({"q-mb-sm":k+1<l.value.length}),onDeleteComment:se,"in-dialog":!0},null,8,["comment","class"])]),skeleton:f(()=>[a($e,{height:"126px",class:"card q-mb-sm"})]),_:1},8,["items","infinite-load-type","no-items-key"])),g.value?L("",!0):(v(),U("div",Pe,[a(D,{class:"load-more",type:"primary",onClick:q,"icon-right":"arrow_circle_down",label:e.$t("load_more")},null,8,["label"])]))]),_:1}),E.value?(v(),S(me,{key:0,class:"q-mb-sm q-mt-sm"})):L("",!0),E.value?(v(),U("div",Re,[i("div",ze,[i("div",Ae,[a(_(Z),{me:!0}),a(ce,{dense:"",borderless:"",rounded:"",modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=o=>m.value=o),autogrow:"",maxlength:"1024",label:u.value=="comment"?e.$t("enter_comment"):e.$t("add_update"),class:"full-width enter-comment",disable:b.value,onKeydown:pe(H,["enter"])},null,8,["modelValue","label","disable"]),a(D,{icon:"send",class:"send-button",onClick:H,loading:b.value,disable:m.value.length==0},null,8,["loading","disable"])])])])):L("",!0)])]),_:1})]),_:1},8,["onHide"]))}});export{Je as default};
