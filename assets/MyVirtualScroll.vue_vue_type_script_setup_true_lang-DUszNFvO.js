const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MySpinner-BcRKf9B2.js","assets/index-C4T2bIgH.js","assets/index-DI-gpe9-.css"])))=>i.map(i=>d[i]);
import{j as ve,E as l,h as Q,W,$ as X,bg as fe,F as de,M as me,p as I,o as b,l as ge,m as M,q as _,aJ as Y,G as Z,I as ee,n as he,v as x,s as te,k as pe,t as be,_ as ye}from"./index-C4T2bIgH.js";import{a as we}from"./QScrollObserver-CCXLn-AB.js";const ke=["data-index"],He={class:"row justify-center q-my-md",style:{"min-height":"55px"}},Ce=ve({__name:"MyVirtualScroll",props:{items:{},margins:{default:0},offset:{default:250},bottomOffset:{default:250},debounce:{default:25},virtualDebounce:{},itemKey:{},infiniteLoadType:{default:"none"},minItemHeight:{default:125},noResizeObserver:{type:Boolean},skeletonHeight:{}},emits:["loadMore","scroll"],setup(oe,{expose:ne,emit:le}){const se=be(()=>ye(()=>import("./MySpinner-BcRKf9B2.js"),__vite__mapDeps([0,1,2]))),i=oe,N=le;ne({updateShowedItems:E,checkLoading:g});const r=l(null),u=l(null),ie=l(null),L=l(window.innerHeight),V=l(0),P=l(0),S=l(0),C=l([0,0]),c=l([0,0]),y=l([]),q=Q(()=>y.value.slice(c.value[0],c.value[1]+1)),F={},d=l([]),w=l(!1),R=l(!1),B=l(!1),K=Q(()=>w.value&&B.value);let k=null;W(w,e=>{k&&clearTimeout(k),e?k=setTimeout(()=>{B.value=!0},200):B.value=!1});function U(e,t){let o=0,n=e.length-1;for(;o<=n;){const s=Math.floor((o+n)/2);e[s]<t?o=s+1:n=s-1}return o}function j(){let e=0;return d.value.map(t=>(e+=(t!=null?t:i.minItemHeight)+i.margins,e))}let f=[];function m(){var o,n,s;const e=U(f,P.value),t=U(f,S.value);c.value[0]=Math.max(e-12,0),c.value[1]=Math.min(t+8,d.value.length-1),C.value[0]=(o=f[c.value[0]-1])!=null?o:0,C.value[1]=((n=f[d.value.length-1])!=null?n:0)-((s=f[c.value[1]])!=null?s:0)}function E(){d.value=i.items.map(e=>{var t;return(t=F[O(e)])!=null?t:void 0}),f=j(),y.value=i.items,m()}const O=e=>e[i.itemKey];function z(){P.value=Math.max(V.value-i.offset,0),S.value=V.value+L.value+i.bottomOffset}let $=null;function ae(){$===null&&($=requestAnimationFrame(()=>{m(),$=null}))}function ue(e){N("scroll",e),V.value=e.position.top,z(),ae(),i.infiniteLoadType==="bottom"&&e.direction==="down"&&g()}function D(){L.value=window.innerHeight,z(),m(),g()}function re(e,t){var v;if(t<=0)return;const o=y.value[e],n=O(o),s=(v=d.value[e])!=null?v:i.minItemHeight;Math.abs(t-s)<1||(F[n]=t,d.value[e]=t,f=j(),m(),e===y.value.length-1&&g())}function ce(){var t;const e=((t=r.value)==null?void 0:t.offsetHeight)||0;return T.value&&i.infiniteLoadType==="bottom"&&(S.value>=e||e<L.value)}function g(){w.value||R.value||!r.value||ce()&&(w.value=!0,N("loadMore",i.items.length-1,e=>{var n,s,v,J;w.value=!1,e&&(R.value=!0);const t=(s=(n=u.value)==null?void 0:n.scrollTop)!=null?s:0,o=(J=(v=u.value)==null?void 0:v.scrollHeight)!=null?J:0;X(()=>{E(),u.value&&u.value.scrollHeight>o&&i.infiniteLoadType==="bottom"&&(u.value.scrollTop=t)})}))}const T=l(!0);function G(e){if(!e.length)T.value=!1;else{const t=e[0];T.value=t.isIntersecting}T.value&&(z(),m(),A(h.value),g())}const h=l([]);fe(()=>{h.value=[]});const p=new Set;let a=null;function A(e){if(!a)return;const t=e.filter(o=>o&&getComputedStyle(o).display!=="none");for(const o of Array.from(p))t.includes(o)||(a.unobserve(o),p.delete(o));for(const o of t)p.has(o)||(a.observe(o),p.add(o))}W(h,()=>{X(()=>A(h.value))},{flush:"post"});let H;return de(()=>{if(y.value=i.items,H=new IntersectionObserver(G,{root:u.value,threshold:.1}),r.value){H.observe(r.value);const e=r.value.getBoundingClientRect(),t=u.value?u.value.getBoundingClientRect():{top:0,bottom:window.innerHeight},o=e.bottom>t.top&&e.top<t.bottom;G([{target:r.value,isIntersecting:o,intersectionRatio:o?1:0,boundingClientRect:e,intersectionRect:e,rootBounds:t,time:performance.now()}])}i.noResizeObserver||(a=new ResizeObserver(e=>{for(const t of e){const o=t.target.getAttribute("data-index");o!==null&&re(Number(o),t.contentRect.height)}})),u.value&&a&&a.observe(u.value),A(h.value),window.addEventListener("resize",D,{passive:!0}),E(),m(),g()}),me(()=>{window.removeEventListener("resize",D),H&&r.value&&(H.unobserve(r.value),H.disconnect()),k&&clearTimeout(k),a&&(p.forEach(e=>a==null?void 0:a.unobserve(e)),u.value&&a.unobserve(u.value),a.disconnect(),a=null,p.clear())}),(e,t)=>{var o;return b(),I("div",{class:"virtual-scroll",ref_key:"scrollContainer",ref:u},[ge(we,{onScroll:ue,debounce:e.debounce},null,8,["debounce"]),M("div",{class:"virtual-scroll-content",ref_key:"scrollContent",ref:r},[M("div",{class:"virtual-filler-top",style:Y({height:`${C.value[0]}px`})},null,4),(b(!0),I(Z,null,ee(q.value,(n,s)=>(b(),I("div",{key:O(n),class:"virtual-item","data-index":c.value[0]+s,ref_for:!0,ref:v=>{v&&te(a)&&(h.value[c.value[0]+s]=v)}},[x(e.$slots,"default",{item:n,index:c.value[0]+s})],8,ke))),128)),M("div",{class:"virtual-filler-bottom",style:Y({height:`${C.value[1]}px`})},null,4)],512),!R.value&&e.infiniteLoadType==="bottom"?(b(),I("div",{key:0,class:he(["virtual-scroll-loading",{invisible:!K.value}]),ref_key:"loadingRef",ref:ie},[!e.$slots.skeleton||e.items.length>0?x(e.$slots,"loading",{key:0},()=>[M("div",He,[K.value?(b(),pe(te(se),{key:0,class:"loading",size:"55px"})):_("",!0)])]):_("",!0)],2)):_("",!0),e.$slots.skeleton&&!R.value&&q.value.length==0&&e.infiniteLoadType==="bottom"?(b(!0),I(Z,{key:1},ee(Math.round(L.value/((o=e.skeletonHeight)!=null?o:100)),n=>x(e.$slots,"skeleton",{key:n})),128)):_("",!0)],512)}}});export{Ce as _};
