import{Q as S}from"./QSpace-BLX8xWL2.js";import{Q as V}from"./QScrollArea-BfWxh7rm.js";import{j as z,aK as A,E as c,aL as D,X as E,p as I,o as C,m as h,l as a,w as v,k as L,n as Q,G as U,aM as q,$ as N}from"./index-CW-_h3H6.js";import{_ as j}from"./MyVirtualScroll.vue_vue_type_script_setup_true_lang--lf3OY7K.js";import{_ as M}from"./MyButton.vue_vue_type_script_setup_true_lang-aOd0h3La.js";import{_ as F}from"./MySelect.vue_vue_type_script_setup_true_lang-D3d6G_xz.js";import{_ as G}from"./RectSkeleton.vue_vue_type_script_setup_true_lang-DcvU8W5z.js";import{_ as O}from"./PostComponent.vue_vue_type_script_setup_true_lang-B2KNN0hS.js";import"./QScrollObserver-B0ZGY-Hj.js";import"./QMenu-Bmlm-oOs.js";import"./CategoryButtons.vue_vue_type_script_setup_true_lang-CndfIUk0.js";import"./ClosePopup-DaR8jHqY.js";import"./format-CjHWdibf.js";import"./i18n-CgE_7Bs0.js";import"./ReactionButtons.vue_vue_type_script_setup_true_lang-BiShpF7h.js";import"./MyChip.vue_vue_type_script_setup_true_lang-DpPNh9Tl.js";const T={class:"card q-mb-sm dialog-section",style:{"z-index":"2"}},X={class:"horizontal-container"},H={class:"horizontal-container",style:{gap:"0"}},ue=z({__name:"UserPosts",props:A({user:{},meta:{}},{expand:{type:Boolean},expandModifiers:{}}),emits:["update:expand"],setup(x){const g=x;let m,y=!0;const k=c(null),l=D(x,"expand"),o=c([]),n=c([]),w=c(Date.now()),$=[{labelKey:"sort.old",icon:"history_2",key:"old"},{labelKey:"sort.new",icon:"update",key:"new"},{labelKey:"sort.popular",icon:"whatshot",key:"popular"}],p=c("new");let d=new AbortController;function B(){l.value||(l.value=!1),l.value=!l.value}function b(){d.abort(),d=new AbortController,o.value=[],n.value=[],m=void 0,w.value=Date.now()}async function K(f,e){const r=o.value.length==0?10:5;try{const s=[];if(n.value.length===0){const t=await q(g.user.user_id,m,p.value,{signal:d.signal}),i=t.data.data.posts;if(y=t.data.data.has_more,m=t.data.data.next_cursor,t.data.success){const u=i.map(_=>({..._,user:g.user}));n.value.push(...u)}}if(s.push(...n.value.splice(0,r)),s.length>0){const t=[...o.value];s.forEach(i=>{const u=t.findIndex(_=>_.post_id===i.post_id);u!==-1?t[u]=i:t.push(i)}),o.value=t}e(!(y||n.value.length>0))}catch(s){throw e(!0),s}}function P(f){o.value=o.value.filter(e=>e.post_id!==f),N(()=>{var e;return(e=k.value)==null?void 0:e.updateShowedItems()})}return E(()=>{d.abort()}),(f,e)=>(C(),I(U,null,[h("div",T,[h("div",X,[a(F,{class:"select",modelValue:p.value,"onUpdate:modelValue":[e[0]||(e[0]=r=>p.value=r),b],options:$,style:{"min-width":"100px",width:"150px","max-width":"300px"}},null,8,["modelValue"]),a(S),h("div",H,[a(M,{icon:l.value?"collapse_content":"expand_content",onClick:B},null,8,["icon"]),a(M,{icon:"refresh",onClick:b})])])]),a(V,{class:"scroll-area full-height fix-scroll-area",visible:!1},{default:v(()=>[(C(),L(j,{items:o.value,margins:8,"item-key":"post_id",onLoadMore:K,"infinite-load-type":"bottom",key:w.value,ref_key:"virtualScroll",ref:k,"skeleton-height":200,"no-items-key":"no_posts"},{default:v(({item:r,index:s})=>[a(O,{post:r,class:Q({"q-mb-sm":s+1<o.value.length}),onDeletePost:P},null,8,["post","class"])]),skeleton:v(()=>[a(G,{height:"200px",class:"card q-mb-sm"})]),_:1},8,["items"]))]),_:1})],64))}});export{ue as default};
