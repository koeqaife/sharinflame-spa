const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CategoryButtons-CTkmDsR6.js","assets/CategoryButtons.vue_vue_type_script_setup_true_lang-CObGevlC.js","assets/ClosePopup-DxrULiaq.js","assets/index-l_6EiOmM.js","assets/index-CxWikQNB.css","assets/MyButton.vue_vue_type_script_setup_true_lang-DcG6jFCe.js","assets/NotificationsList-JfCYnSUw.js","assets/format-BppvpZm3.js","assets/ProfileMenu-C4orGQ2X.js","assets/profile-store-D2wvwJxl.js","assets/MySwitch.vue_vue_type_script_setup_true_lang-DRuMC1kb.js","assets/UserAvatar.vue_vue_type_script_setup_true_lang-CmVZDzsn.js","assets/OpenProfileMenu-B9IH1iz2.js","assets/QMenu-_zkK67Dr.js","assets/QScrollArea-mdEooM_N.js","assets/QScrollObserver-JKExWDMz.js","assets/ParticlesBackground-C0uoJE-q.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/ParticlesBackground-CdbJk_l4.css"])))=>i.map(i=>d[i]);
import{j as X,E as k,D as G,W as J,X as te,p as P,o as d,l as n,T as Y,w as m,k as T,aa as W,$ as oe,as as se,at as ae,ad as ne,u as ie,h as _,F as le,M as re,au as ce,av as ue,m as y,q as v,O as de,s as C,t as N,H as U,n as j,_ as O}from"./index-l_6EiOmM.js";import{Q as pe}from"./QMenu-_zkK67Dr.js";import{Q as F}from"./QSpace-DDQX1Er7.js";import{Q as fe}from"./QPage-DJ4v4v4j.js";import{C as me}from"./ClosePopup-DxrULiaq.js";import{Q as _e}from"./QScrollArea-mdEooM_N.js";import{_ as ve}from"./MyVirtualScroll.vue_vue_type_script_setup_true_lang-DASDDHtA.js";import{_ as ge}from"./RectSkeleton.vue_vue_type_script_setup_true_lang-DrxKyEa7.js";import{_ as he}from"./PostComponent.vue_vue_type_script_setup_true_lang-DNetXo-Z.js";import{_ as we}from"./MainLayout.vue_vue_type_script_setup_true_lang-D2roXYoX.js";import{_ as R,a as ye}from"./MyButton.vue_vue_type_script_setup_true_lang-DcG6jFCe.js";import{_ as ke}from"./MySelect.vue_vue_type_script_setup_true_lang-Cw6r2Gpt.js";import"./QScrollObserver-JKExWDMz.js";import"./format-BppvpZm3.js";import"./i18n-cM6l_DkN.js";import"./ReactionButtons.vue_vue_type_script_setup_true_lang-BVH4ZTPF.js";import"./MyChip.vue_vue_type_script_setup_true_lang-DezKdzRk.js";import"./QLayout-BMt7r-no.js";import"./LogoComponent.vue_vue_type_script_setup_true_lang-DlFsDf0e.js";import"./CategoryButtons.vue_vue_type_script_setup_true_lang-CObGevlC.js";const be=X({__name:"PostScroll",props:{type:{}},emits:["scroll"],setup(H,{emit:K}){let g=new AbortController;const L=H,Q=K,p=k([]),h=k(L.type),f=[],l=[],r=[],$=k(null),b=["new","following","popular"];let V;const{t:I}=G();J(()=>L.type,w);function z(){g.abort(),g=new AbortController,p.value=[],f.length=0,l.length=0,r.length=0,V=void 0}async function D(a,e=50){const s=[];for(;a.length>0;){const i=a.splice(0,e);s.push(se(i))}await Promise.all(s)}function w(){z(),h.value=`${L.type}-${Date.now()}`}async function A(a){const e=b.some(i=>i==a);!e&&f.length>0&&await D(f);const s=await ae(a,e?V:void 0,!e,{signal:g.signal});return s.data.success&&(V=s.data.data.next_cursor,l.push(...s.data.data.posts)),s.data}async function q(a){let e=l.slice(0,a);const s=async i=>{var S,t,o;let c;try{return c=await ne(i,{signal:g.signal}),c.data.success&&r.push(...c.data.data.posts),null}catch(u){if(W(u)){const M=(o=(t=(S=u.response)==null?void 0:S.data)==null?void 0:t.data)==null?void 0:o.errors;if(M)return i.filter(Z=>!M.some(ee=>ee.post===Z))}throw u}};for(let i=0;i<a&&e.length!=0;i++){const c=await s(e);if(c===null)break;e=c}l.splice(0,a)}function E(a){if(a>r.length){const s=[...r];return r.length=0,s}const e=r.slice(-a);return r.splice(-a),e}async function x(a,e){var i,c,S,t;const s=p.value.length==0?Math.min(window.innerHeight/125+1,15):5;try{if(r.length==0&&l.length==0&&!(await A(L.type)).success)return;if(r.length==0&&await q(s),r.length!=0){const o=E(s);p.value.push(...o);const u=o.map(M=>M.post_id);f.push(...u),p.value.length>=20&&f.length>=10&&D(f)}e()}catch(o){if(W(o)){if(o.code==="ERR_CANCELED"){e(!0);return}if(!o.response)throw e(!0),o;const u=((c=(i=o.response)==null?void 0:i.data)==null?void 0:c.error)=="NO_MORE_POSTS"?I("no_more_posts"):(t=(S=o.response)==null?void 0:S.data)==null?void 0:t.error.toLowerCase();p.value.push({is_system:!0,post_id:`${Date.now()}`,content:`<b>${I("an_error_occurred")}:</b> ${u}.
${I("try_reloading_feed")}.`,actions:[{name:"reload",icon:"refresh",func:()=>w()}]}),e(!0)}else throw o}}function B(a){p.value=p.value.filter(e=>e.post_id!==a),oe(()=>{var e;return(e=$.value)==null?void 0:e.updateShowedItems()})}return te(()=>{g.abort()}),(a,e)=>(d(),P("div",null,[n(Y,{name:"post-scroll"},{default:m(()=>[(d(),T(_e,{class:"scroll-area full-height",visible:!1,key:h.value},{default:m(()=>[n(ve,{items:p.value,margins:8,"item-key":"post_id","infinite-load-type":"bottom",class:"posts-infinite-scroll",onLoadMore:x,onScroll:e[0]||(e[0]=s=>Q("scroll",s)),ref_key:"virtualScroll",ref:$,"skeleton-height":200},{default:m(({item:s})=>[n(he,{class:"q-mb-sm",post:s,onDeletePost:B},null,8,["post"])]),skeleton:m(()=>[n(ge,{height:"200px",class:"card q-mb-sm","wait-time":1e3})]),_:1},8,["items"])]),_:1}))]),_:1})]))}}),Se={class:"button-and-badge"},Ce={key:1,class:"button-badge"},Pe={key:0,class:"left-column"},Le={class:"card categories"},$e={class:"center-column container",style:{gap:"0px"}},De={class:"full-height"},Ee={key:1,class:"right-column"},Te={class:"container right-column-content"},Ve={class:"card profile-menu"},Ie={key:0,class:"card notifications-list container"},Ae={class:"label"},Be={key:0,class:"unread-count"},tt=X({__name:"AppPage",setup(H){const K=N(()=>O(()=>import("./CategoryButtons-CTkmDsR6.js"),__vite__mapDeps([0,1,2,3,4,5]))),g=N(()=>O(()=>import("./NotificationsList-JfCYnSUw.js"),__vite__mapDeps([6,3,4,7]))),L=N(()=>O(()=>import("./ProfileMenu-C4orGQ2X.js"),__vite__mapDeps([8,3,4,2,9,10,5,11]))),Q=N(()=>O(()=>import("./OpenProfileMenu-B9IH1iz2.js"),__vite__mapDeps([12,3,4,13,14,15,5]))),p=N(()=>O(()=>import("./ParticlesBackground-C0uoJE-q.js"),__vite__mapDeps([16,3,4,17,18]))),h=ie(),{t:f}=G(),l=k("popular"),r=k(Date.now()),$=k(!1),b=k([window.innerWidth,window.innerHeight]),V=_(()=>b.value[0]<=850),I=_(()=>b.value[0]>=1200),z=_(()=>b.value[1]<=750),D=_(()=>!I.value),w=_(()=>V.value),A=_(()=>w.value||z.value),q=_(()=>{let t=3;return D.value&&t--,w.value&&t--,t}),E=_(()=>h.getUnreadCount()),x=k(!1),B=t=>{l.value==t?r.value=Date.now():l.value=t};function a(t){x.value=t.position.top>8}const e=_(()=>[{icon:"whatshot",label:f("categories.popular"),click:()=>B("popular"),type:"popular"},{icon:"update",label:f("categories.new"),click:()=>B("new"),type:"new"},{icon:"group",label:f("categories.following"),click:()=>B("following"),type:"following"}]),s=[{labelKey:"categories.popular",icon:"whatshot",key:"popular"},{labelKey:"categories.new",icon:"update",key:"new"},{labelKey:"categories.following",icon:"group",key:"following"}],i=()=>{b.value[0]=window.innerWidth,b.value[1]=window.innerHeight};function c(){h.openDialog("notifications","",{})}J(l,t=>{localStorage.setItem("lastSelectedType",t)});async function S(){var t;await Notification.requestPermission(),(t=h.openedDialogs.get("okCancel"))==null||t.hide()}return le(()=>{i(),window.addEventListener("resize",i,{passive:!0}),Notification.permission=="default"&&h.openDialog("okCancel","",{localeKey:"notification_permission",okKey:"yes",cancelKey:"no"},()=>void S())}),re(()=>{window.removeEventListener("resize",i)}),ce(()=>{const t=localStorage.getItem("lastSelectedType");t&&e.value.find(o=>o.type===t)&&(l.value=t)}),(t,o)=>(d(),T(we,{"in-router":!1,"headers-class":"index-10",class:"full-height"},ue({default:m(()=>[C(h).getSetting("starBackground")?(d(),T(C(p),{key:0})):v("",!0),n(fe,{class:j(["app-page",`columns-${q.value}`])},{default:m(()=>[D.value?v("",!0):(d(),P("div",Pe,[y("div",Le,[n(C(K),{"categories-list":e.value,"current-type":l.value},null,8,["categories-list","current-type"])])])),y("div",$e,[D.value?(d(),P("div",{key:0,class:j(["horizontal-container categories-label card",{scrolled:x.value}])},[n(ke,{options:s,modelValue:l.value,"onUpdate:modelValue":o[2]||(o[2]=u=>l.value=u)},null,8,["modelValue"]),n(F),n(R,{icon:"refresh",class:"reload-button",onClick:o[3]||(o[3]=u=>r.value=Date.now())})],2)):v("",!0),y("div",De,[n(Y,{name:"post-scroll"},{default:m(()=>[(d(),T(be,{type:l.value,key:r.value,class:"full-height full-width",onScroll:a},null,8,["type"]))]),_:1})])]),w.value?v("",!0):(d(),P("div",Ee,[y("div",Te,[y("div",Ve,[n(C(L),{"buttons-class":"card-button"})]),A.value?v("",!0):(d(),P("div",Ie,[y("div",{class:"label-container horizontal-container card",onClick:c},[n(ye,{icon:"notifications",class:"icon"}),y("div",Ae,U(t.$t("notifications.label")),1),E.value>0?(d(),P("span",Be,U(E.value),1)):v("",!0),n(F),n(R,{icon:"expand_content",onClick:c})]),n(C(g))]))])]))]),_:1},8,["class"])]),_:2},[w.value||A.value?{name:"toolbar-actions",fn:m(()=>[y("div",Se,[A.value?(d(),T(R,{key:0,icon:"notifications",class:"webkit-no-drag"},{default:m(()=>[n(pe,{class:"menu-card notifications-menu",modelValue:$.value,"onUpdate:modelValue":o[1]||(o[1]=u=>$.value=u)},{default:m(()=>[n(C(g),{onOnLoaded:o[0]||(o[0]=u=>$.value=!1)}),de(n(R,{icon:"expand_content",type:"primary",label:t.$t("show_all"),class:"full-width q-mt-sm centered",onClick:c},null,8,["label"]),[[me]])]),_:1},8,["modelValue"])]),_:1})):v("",!0),E.value>0?(d(),P("span",Ce,U(E.value),1)):v("",!0)]),w.value?(d(),T(C(Q),{key:0})):v("",!0)]),key:"0"}:void 0]),1024))}});export{tt as default};
