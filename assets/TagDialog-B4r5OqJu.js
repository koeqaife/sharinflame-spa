const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PostComponent-B09f_WtN.js","assets/PostComponent.vue_vue_type_script_setup_true_lang-DNetXo-Z.js","assets/index-l_6EiOmM.js","assets/index-CxWikQNB.css","assets/QSpace-DDQX1Er7.js","assets/QMenu-_zkK67Dr.js","assets/QScrollArea-mdEooM_N.js","assets/QScrollObserver-JKExWDMz.js","assets/format-BppvpZm3.js","assets/i18n-cM6l_DkN.js","assets/ReactionButtons.vue_vue_type_script_setup_true_lang-BVH4ZTPF.js","assets/MyButton.vue_vue_type_script_setup_true_lang-DcG6jFCe.js","assets/MyChip.vue_vue_type_script_setup_true_lang-DezKdzRk.js"])))=>i.map(i=>d[i]);
import{j as ae,u as oe,D as se,E as g,h as I,F as ne,a9 as ie,aa as L,X as re,k as z,o as H,w as v,l as s,s as C,m as o,H as u,ab as N,n as Q,t as le,Q as ce,_ as de,ac as ue,$ as fe,ad as me}from"./index-l_6EiOmM.js";import{Q as B}from"./QSpace-DDQX1Er7.js";import{Q as pe}from"./QScrollArea-mdEooM_N.js";import{u as V}from"./use-dialog-plugin-component-DbunqMJY.js";import{_ as ge}from"./CloseableContent.vue_vue_type_script_setup_true_lang-L6ujJjS4.js";import{_ as _e}from"./MyVirtualScroll.vue_vue_type_script_setup_true_lang-DASDDHtA.js";import{a as y,_ as x}from"./MyButton.vue_vue_type_script_setup_true_lang-DcG6jFCe.js";import{f as he}from"./format-BppvpZm3.js";import{_ as ve}from"./RectSkeleton.vue_vue_type_script_setup_true_lang-DrxKyEa7.js";import"./QScrollObserver-JKExWDMz.js";const ye={class:"dialog-header",style:{"z-index":"2"}},be={class:"horizontal-container label-container"},Ce={class:"dialog-content-inner"},we={class:"card dialog-section q-mb-sm",style:{"z-index":"2"}},ke={class:"horizontal-container"},Te=ae({__name:"TagDialog",props:{tagName:{}},emits:[...V.emits],setup(q){const M=le(()=>de(()=>import("./PostComponent-B09f_WtN.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),U=oe(),{t:w}=se(),k=q,{dialogRef:$,onDialogHide:j}=V(),S=g(null);let f=new AbortController;const A=g(!0),F=I(()=>_.value?he(_.value.created_at):w("loading")+"..."),K=I(()=>_.value?String(_.value.posts_count):w("loading")+"..."),_=g(),c=g([]),P=g(Date.now()),h=[],n=[];let D,E=!0;const R=g(null);function O(e){A.value=e.position.top<S.value.scrollHeight+66||e.direction=="up"}function X(){U.openDialog("postEditor","",{withCtags:[k.tagName]})}function G(){f.abort(),f=new AbortController,c.value=[],h.length=0,n.length=0,D=void 0,E=!0}function T(){G(),P.value=Date.now()}async function J(e){let t=h.slice(0,e);const d=async i=>{var a,l,m;let r;try{return r=await me(i,{signal:f.signal}),r.data.success&&n.push(...r.data.data.posts),null}catch(p){if(L(p)){const b=(m=(l=(a=p.response)==null?void 0:a.data)==null?void 0:l.data)==null?void 0:m.errors;if(b)return i.filter(ee=>!b.some(te=>te.post===ee))}throw p}};for(let i=0;i<e&&t.length!=0;i++){const r=await d(t);if(r===null)break;t=r}h.splice(0,e)}function W(e){if(e>n.length){const d=[...n];return n.length=0,d}const t=n.slice(-e);return n.splice(-e),t}async function Y(e,t){var i,r;try{if(n.length==0&&h.length==0){if(!E){t(!0);return}const a=await ue(k.tagName,D,{signal:f.signal});if(a.data.success)E=a.data.data.has_more,D=a.data.data.next_cursor,h.push(...a.data.data.posts);else{t(!0);return}}if(n.length==0&&await J(20),n.length!=0){const a=W(20),l=c.value;a.forEach(m=>{const p=l.findIndex(b=>b.post_id===m.post_id);p!==-1?l[p]=m:l.push(m)}),c.value=l}t()}catch(a){if(L(a)){if(a.code==="ERR_CANCELED"){t(!0);return}if(!a.response)throw t(!0),a;const l=(r=(i=a.response)==null?void 0:i.data)==null?void 0:r.error.toLowerCase();c.value.push({is_system:!0,post_id:`${Date.now()}`,content:`<b>${w("an_error_occurred")}:</b> ${l}.`,actions:[{name:"reload",icon:"refresh",func:()=>T()}]}),t(!0)}else throw a}}function Z(e){c.value=c.value.filter(t=>t.post_id!==e),fe(()=>{var t;return(t=R.value)==null?void 0:t.updateShowedItems()})}return ne(async()=>{try{const e=await ie(k.tagName,{signal:f.signal});e.data.success&&(_.value=e.data.data)}catch(e){if(L(e)&&e.code==="ERR_CANCELED")return;throw e}}),re(()=>{f.abort()}),(e,t)=>(H(),z(ce,{"transition-show":"slide-up","transition-hide":"slide-down",class:"tag-dialog card-dialog",ref_key:"dialogRef",ref:$,onHide:C(j),maximized:"",key:e.tagName},{default:v(()=>[s(ge,{onHide:t[1]||(t[1]=d=>C($).hide())},{default:v(()=>[o("div",ye,[o("div",be,[s(y,{icon:"tag",class:"header-icon"}),o("div",null,u(e.$t("ctag")),1),s(B),s(x,{icon:"close",onClick:t[0]||(t[0]=d=>C($).hide())})])]),o("div",Ce,[s(pe,{class:"scroll-area fix-scroll-area",visible:!1},{default:v(()=>[o("div",{ref_key:"tagComponentRef",ref:S,class:"card tag-card"},[o("div",null,[s(y,{icon:"title"}),o("b",null,u(e.$t("tag_name")+": "),1),N(u(e.tagName),1)]),o("div",null,[s(y,{icon:"event"}),o("b",null,u(e.$t("created_at")+": "),1),N(u(F.value),1)]),o("div",null,[s(y,{icon:"history"}),o("b",null,u(e.$t("posts_count")+": "),1),N(" "+u(K.value),1)])],512),o("div",{class:Q(["sticky-label scroll-header q-pt-sm",{"is-visible":A.value}])},[o("div",we,[o("div",ke,[s(y,{icon:"article",class:"icon"}),o("div",null,u(e.$t("posts")),1),s(B),s(x,{icon:"add_2",onClick:X}),s(x,{icon:"refresh",onClick:T})])])],2),(H(),z(_e,{items:c.value,margins:8,"item-key":"post_id",onLoadMore:Y,onScroll:O,"infinite-load-type":"bottom",key:P.value,class:"posts-infinite-scroll",ref_key:"virtualScroll",ref:R,"skeleton-height":200},{default:v(({item:d,index:i})=>[s(C(M),{class:Q({"q-mb-sm":i+1<c.value.length}),post:d,onDeletePost:Z},null,8,["class","post"])]),skeleton:v(()=>[s(ve,{height:"200px",class:"card q-mb-sm"})]),_:1},8,["items"]))]),_:1})])]),_:1})]),_:1},8,["onHide"]))}});export{Te as default};
