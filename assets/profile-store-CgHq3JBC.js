import{b9 as r,ba as f,bb as c}from"./index-Ck4zLN3I.js";const u=r("profile",{state:()=>({profiles:{},cleanupInterval:null,ttl:300}),getters:{profile:a=>{var i;return(i=a.profiles.me)==null?void 0:i.data}},actions:{async getProfile(a="me"){var s,o;this.cleanupInterval||this.startCleanup(this.ttl*3);const i=Math.floor(Date.now()/1e3);(o=(s=this.profiles)[a])!=null||(s[a]={data:void 0,lastUpdate:0,isLoading:!1});const t=this.profiles[a],n=async()=>{t.isLoading=!0;try{const e=await c(a);e.status===200&&e.data.success&&(t.data=e.data.data,t.lastUpdate=Math.floor(Date.now()/1e3))}finally{t.isLoading=!1}};return t.isLoading?new Promise(e=>{const l=setInterval(()=>{t.isLoading||(clearInterval(l),e(t.data))},100)}):(t.data?i-t.lastUpdate>=this.ttl&&n():await n(),t.data)},async updateProfile(a,i,t){if(await this.getProfile("me"),(await f(a)).status===204){const s=this.profiles.me.data,o=["display_name","languages","bio","avatar_context_id","banner_context_id"];i!==void 0&&(s.avatar_url=i),t!==void 0&&(s.banner_url=t),o.forEach(e=>{const l=a[e];l!==void 0&&e!=="avatar_context_id"&&e!=="banner_context_id"&&(s[e]=e==="languages"?[...l]:l)})}},startCleanup(a=600){this.cleanupInterval&&clearInterval(this.cleanupInterval),this.cleanupInterval=setInterval(()=>{const i=Math.floor(Date.now()/1e3);for(const t in this.profiles){if(t=="me")continue;const n=this.profiles[t];i-n.lastUpdate>this.ttl*2&&delete this.profiles[t]}},a*1e3)},stopCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}}});export{u};
