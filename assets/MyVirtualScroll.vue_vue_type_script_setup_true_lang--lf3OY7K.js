const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MySpinner-aqX1XRWk.js","assets/index-CW-_h3H6.js","assets/index-bp0Wj9ML.css"])))=>i.map(i=>d[i]);
import{j as ve,E as l,h as W,W as x,$ as X,bg as de,F as fe,M as me,p as w,o as f,l as ge,q as C,m as V,H as he,aJ as Y,G as Z,I as ee,n as pe,v as N,s as te,k as be,t as ye,_ as we}from"./index-CW-_h3H6.js";import{a as ke}from"./QScrollObserver-B0ZGY-Hj.js";const Ie={key:0,class:"no-items-label"},He=["data-index"],Le={class:"row justify-center q-my-md",style:{"min-height":"55px"}},Re=ve({__name:"MyVirtualScroll",props:{items:{},margins:{default:0},offset:{default:250},bottomOffset:{default:250},debounce:{default:25},virtualDebounce:{},itemKey:{},infiniteLoadType:{default:"none"},minItemHeight:{default:125},noResizeObserver:{type:Boolean},skeletonHeight:{},noItemsLabel:{type:Boolean,default:!0},noItemsKey:{default:"no_items"}},emits:["loadMore","scroll"],setup(oe,{expose:ne,emit:le}){const se=ye(()=>we(()=>import("./MySpinner-aqX1XRWk.js"),__vite__mapDeps([0,1,2]))),s=oe,P=le;ne({updateShowedItems:O,checkLoading:p});const r=l(null),u=l(null),ie=l(null),T=l(window.innerHeight),_=l(0),q=l(0),B=l(0),R=l([0,0]),c=l([0,0]),k=l([]),D=W(()=>k.value.slice(c.value[0],c.value[1]+1)),F={},m=l([]),g=l(!1),M=l(!1),E=l(!1),U=W(()=>g.value&&E.value);let I=null;x(g,e=>{I&&clearTimeout(I),e?I=setTimeout(()=>{E.value=!0},200):E.value=!1});function j(e,t){let o=0,a=e.length-1;for(;o<=a;){const n=Math.floor((o+a)/2);e[n]<t?o=n+1:a=n-1}return o}function G(){let e=0;return m.value.map(t=>(e+=(t!=null?t:s.minItemHeight)+s.margins,e))}let d=[];function h(){var o,a,n;const e=j(d,q.value),t=j(d,B.value);c.value[0]=Math.max(e-12,0),c.value[1]=Math.min(t+8,m.value.length-1),R.value[0]=(o=d[c.value[0]-1])!=null?o:0,R.value[1]=((a=d[m.value.length-1])!=null?a:0)-((n=d[c.value[1]])!=null?n:0)}function O(){m.value=s.items.map(e=>{var t;return(t=F[$(e)])!=null?t:void 0}),d=G(),k.value=s.items,h()}const $=e=>e[s.itemKey];function z(){q.value=Math.max(_.value-s.offset,0),B.value=_.value+T.value+s.bottomOffset}let A=null;function ae(){A===null&&(A=requestAnimationFrame(()=>{h(),A=null}))}function ue(e){P("scroll",e),_.value=e.position.top,z(),ae(),s.infiniteLoadType==="bottom"&&e.direction==="down"&&p()}function J(){T.value=window.innerHeight,z(),h(),p()}function re(e,t){var v;if(t<=0)return;const o=k.value[e],a=$(o),n=(v=m.value[e])!=null?v:s.minItemHeight;Math.abs(t-n)<1||(F[a]=t,m.value[e]=t,d=G(),h(),e===k.value.length-1&&p())}function ce(){var t;const e=((t=r.value)==null?void 0:t.offsetHeight)||0;return S.value&&s.infiniteLoadType==="bottom"&&(B.value>=e||e<T.value)}function p(){g.value||M.value||!r.value||ce()&&(g.value=!0,P("loadMore",s.items.length-1,e=>{var a,n,v,L;g.value=!1,e&&(M.value=!0);const t=(n=(a=u.value)==null?void 0:a.scrollTop)!=null?n:0,o=(L=(v=u.value)==null?void 0:v.scrollHeight)!=null?L:0;X(()=>{O(),u.value&&u.value.scrollHeight>o&&s.infiniteLoadType==="bottom"&&(u.value.scrollTop=t)})}))}const S=l(!0);function Q(e){if(!e.length)S.value=!1;else{const t=e[0];S.value=t.isIntersecting}S.value&&(z(),h(),K(b.value),p())}const b=l([]);de(()=>{b.value=[]});const y=new Set;let i=null;function K(e){if(!i)return;const t=e.filter(o=>o&&getComputedStyle(o).display!=="none");for(const o of Array.from(y))t.includes(o)||(i.unobserve(o),y.delete(o));for(const o of t)y.has(o)||(i.observe(o),y.add(o))}x(b,()=>{X(()=>K(b.value))},{flush:"post"});let H;return fe(()=>{if(k.value=s.items,H=new IntersectionObserver(Q,{root:u.value,threshold:.1}),r.value){H.observe(r.value);const e=r.value.getBoundingClientRect(),t=u.value?u.value.getBoundingClientRect():{top:0,bottom:window.innerHeight},o=e.bottom>t.top&&e.top<t.bottom;Q([{target:r.value,isIntersecting:o,intersectionRatio:o?1:0,boundingClientRect:e,intersectionRect:e,rootBounds:t,time:performance.now()}])}s.noResizeObserver||(i=new ResizeObserver(e=>{for(const t of e){const o=t.target.getAttribute("data-index");o!==null&&re(Number(o),t.contentRect.height)}})),u.value&&i&&i.observe(u.value),K(b.value),window.addEventListener("resize",J,{passive:!0}),O(),h(),p()}),me(()=>{window.removeEventListener("resize",J),H&&r.value&&(H.unobserve(r.value),H.disconnect()),I&&clearTimeout(I),i&&(y.forEach(e=>i==null?void 0:i.unobserve(e)),u.value&&i.unobserve(u.value),i.disconnect(),i=null,y.clear())}),(e,t)=>{var o,a;return f(),w("div",{class:"virtual-scroll",ref_key:"scrollContainer",ref:u},[ge(ke,{onScroll:ue,debounce:e.debounce},null,8,["debounce"]),e.noItemsLabel&&!g.value&&e.items.length==0&&e.infiniteLoadType!=="none"?(f(),w("div",Ie,he(e.$t((o=e.noItemsKey)!=null?o:"no_items")),1)):C("",!0),V("div",{class:"virtual-scroll-content",ref_key:"scrollContent",ref:r},[V("div",{class:"virtual-filler-top",style:Y({height:`${R.value[0]}px`})},null,4),(f(!0),w(Z,null,ee(D.value,(n,v)=>(f(),w("div",{key:$(n),class:"virtual-item","data-index":c.value[0]+v,ref_for:!0,ref:L=>{L&&te(i)&&(b.value[c.value[0]+v]=L)}},[N(e.$slots,"default",{item:n,index:c.value[0]+v})],8,He))),128)),V("div",{class:"virtual-filler-bottom",style:Y({height:`${R.value[1]}px`})},null,4)],512),!M.value&&e.infiniteLoadType==="bottom"?(f(),w("div",{key:1,class:pe(["virtual-scroll-loading",{invisible:!U.value}]),ref_key:"loadingRef",ref:ie},[!e.$slots.skeleton||e.items.length>0?N(e.$slots,"loading",{key:0},()=>[V("div",Le,[U.value?(f(),be(te(se),{key:0,class:"loading",size:"55px"})):C("",!0)])]):C("",!0)],2)):C("",!0),e.$slots.skeleton&&!M.value&&D.value.length==0&&e.infiniteLoadType==="bottom"?(f(!0),w(Z,{key:2},ee(Math.round(T.value/((a=e.skeletonHeight)!=null?a:100)),n=>N(e.$slots,"skeleton",{key:n})),128)):C("",!0)],512)}}});export{Re as _};
