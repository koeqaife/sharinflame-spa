const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CommentComponent-CXqMNqG_.js","assets/CommentComponent.vue_vue_type_script_setup_true_lang-s07qYOxE.js","assets/index-CFDL-CVp.js","assets/index-CIwtCw06.css","assets/QSpace-Bx2Tzmy6.js","assets/QMenu-BeQtP8gf.js","assets/QScrollArea-D_N-OP8b.js","assets/QScrollObserver-DN6LsUr8.js","assets/format-CB8cfGO0.js","assets/ReactionButtons.vue_vue_type_script_setup_true_lang-Bl9fB1-t.js","assets/MyButton.vue_vue_type_script_setup_true_lang-BrbV-gT4.js","assets/i18n-BoPRfTTY.js","assets/UserAvatar-BiQc8yBB.js","assets/UserAvatar.vue_vue_type_script_setup_true_lang-9AcvX9BO.js","assets/profile-store-3JWJIDcz.js"])))=>i.map(i=>d[i]);
import{j as ae,E as i,V as ne,W as le,F as se,X as ie,k as K,o as p,w as _,l as t,s as u,m as l,H as V,p as z,q as L,t as N,n as T,R as re,Y as me,Z as de,Q as ce,_ as U,$ as q,a0 as ue,a1 as ve}from"./index-CFDL-CVp.js";import{Q as O}from"./QSpace-Bx2Tzmy6.js";import{Q as fe}from"./QScrollArea-D_N-OP8b.js";import{_ as pe}from"./CloseableContent.vue_vue_type_script_setup_true_lang-B4TJvAi3.js";import{_ as _e}from"./MyVirtualScroll.vue_vue_type_script_setup_true_lang-rXOZgMlD.js";import{u as j}from"./use-dialog-plugin-component-CjaeI9jv.js";import{u as he}from"./profile-store-3JWJIDcz.js";import{a as F,_ as $}from"./MyButton.vue_vue_type_script_setup_true_lang-BrbV-gT4.js";import{_ as ge}from"./RectSkeleton.vue_vue_type_script_setup_true_lang-Bhv09ipN.js";import"./QScrollObserver-DN6LsUr8.js";const ye={class:"dialog-header",style:{"z-index":"2"}},Ce={class:"horizontal-container label-container"},be={class:"dialog-content-inner"},ke={class:"card dialog-section q-mb-sm",style:{"z-index":"2"}},we={class:"horizontal-container"},De={key:1,class:"no-comments"},$e={key:2,class:"load-more-container"},Re={class:"card send-comment"},Se={class:"card-section"},xe={class:"horizontal-container align-end full-width"},Me=ae({__name:"RepliesDialog",props:{parentComment:{},comment:{},firstComment:{},autoLoad:{type:Boolean,default:!0},onDelete:{},inDialog:{type:Boolean,default:!0}},emits:[...j.emits],setup(W){var P;const R=N(()=>U(()=>import("./CommentComponent-CXqMNqG_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),X=N(()=>U(()=>import("./UserAvatar-BiQc8yBB.js"),__vite__mapDeps([12,13,2,3,14]))),d=W,v=i(!1),Y=he(),r=ne(d.comment),A=i(Date.now()),s=i([]),m=i([]),S=i(!0),E=i(null),Q=i(null),h=i(null),g=i(d.autoLoad);let H=!0,x,y=new AbortController;const c=i(((P=r.value._meta)==null?void 0:P.text)||""),C=i(!1);le(c,()=>ee("text",c.value));const{dialogRef:b,onDialogHide:Z}=j();function B(){g.value=!0,q(()=>{var e;(e=h.value)==null||e.checkLoading()})}function G(e){S.value=e.position.top<E.value.scrollHeight+Q.value.scrollHeight+66||e.direction=="up"}function J(){y.abort(),y=new AbortController,v.value=!1,s.value=[],m.value=[],A.value=Date.now(),x=void 0,S.value=!0,g.value||B()}function ee(e,o){var a;(a=r.value)._meta||(a._meta={}),r.value._meta[e]=o}async function oe(e,o){var k;v.value=!1;const a=[];(k=m.value)!=null||(m.value=[]);try{if(m.value.length===0){const n=await ue(r.value.post_id,x,void 0,{signal:y.signal},r.value.comment_id),f=n.data.data.comments;if(H=n.data.data.has_more,x=n.data.data.next_cursor,n.data.success){const w=n.data.data.users;m.value.push(...f.map(D=>({...D,user:w[D.user_id]})))}}if(a.push(...m.value.splice(0,5)),a.length>0){const n=s.value;a.forEach(f=>{const w=n.findIndex(D=>D.comment_id===f.comment_id);w!==-1?n[w]=f:n.push(f)}),s.value=n}o(!(H||m.value.length>0))}catch(n){throw o(!0),n}finally{s.value.length==0&&(v.value=!0)}}async function I(e){if(!(e instanceof KeyboardEvent&&e.shiftKey)){C.value=!0;try{const o=await ve(r.value.post_id,c.value,void 0,void 0,r.value.comment_id);if(o.data.success){const a={...o.data.data,user:await Y.getProfile()};s.value.unshift(a),c.value="",r.value.replies_count+=1}}finally{v.value=!1,C.value=!1,q(()=>{var o;return(o=h.value)==null?void 0:o.updateShowedItems(1)})}}}function M(){var e;(e=b.value)==null||e.hide(),d.onDelete&&d.onDelete()}function te(e){s.value=s.value.filter(o=>o.comment_id!==e),r.value.replies_count-=1,q(()=>{var o;return(o=h.value)==null?void 0:o.updateShowedItems()})}return se(()=>{d.firstComment&&s.value.push(d.firstComment)}),ie(()=>{s.value=[],m.value=[],y.abort()}),(e,o)=>(p(),K(ce,{"transition-show":"slide-up","transition-hide":"slide-down",class:"comment-dialog card-dialog",ref_key:"dialogRef",ref:b,onHide:u(Z),maximized:"",key:e.comment.comment_id},{default:_(()=>[t(pe,{onHide:o[2]||(o[2]=a=>u(b).hide())},{default:_(()=>[l("div",ye,[l("div",Ce,[t(F,{icon:"chat_bubble",class:"header-icon"}),l("div",null,V(e.$t("comment")),1),t(O),t($,{icon:"close",onClick:o[0]||(o[0]=a=>u(b).hide())})])]),l("div",be,[t(fe,{class:"scroll-area fix-scroll-area",visible:!1},{default:_(()=>[e.parentComment?(p(),z("div",{key:0,ref_key:"parentCommentComponentRef",ref:Q,class:"q-mb-sm"},[t(u(R),{comment:e.parentComment,"in-dialog":d.inDialog,onDeleteComment:M,"is-parent":"",style:{"z-index":"2"}},null,8,["comment","in-dialog"])],512)):L("",!0),l("div",{ref_key:"commentComponentRef",ref:E},[t(u(R),{comment:r.value,"in-dialog":d.inDialog,"in-replies-dialog":!0,onDeleteComment:M,style:{"z-index":"2"}},null,8,["comment","in-dialog"])],512),l("div",{class:T(["sticky-label scroll-header q-pt-sm",{"is-visible":S.value}])},[l("div",ke,[l("div",we,[t(F,{icon:"reply",class:"icon"}),l("div",null,V(e.$t("replies")),1),t(O),t($,{icon:"refresh",onClick:J})])])],2),v.value?(p(),z("div",De,V(e.$t("no_replies")),1)):L("",!0),(p(),K(_e,{items:s.value,margins:8,"item-key":"comment_id",onLoadMore:oe,onScroll:G,"infinite-load-type":g.value?"bottom":"none",key:A.value,class:"posts-infinite-scroll",ref_key:"virtualScroll",ref:h,"skeleton-height":126},{default:_(({item:a,index:k})=>[t(u(R),{comment:a,class:T({"q-mb-sm":k+1<s.value.length}),onDeleteComment:te,"in-dialog":e.inDialog,"hide-go-to":!0},null,8,["comment","class","in-dialog"])]),skeleton:_(()=>[t(ge,{height:"126px",class:"card q-mb-sm"})]),_:1},8,["items","infinite-load-type"])),g.value?L("",!0):(p(),z("div",$e,[t($,{class:"load-more",type:"primary",onClick:B,"icon-right":"arrow_circle_down",label:e.$t("load_more")},null,8,["label"])]))]),_:1}),t(re,{class:"q-mb-sm q-mt-sm"}),l("div",Re,[l("div",Se,[l("div",xe,[t(u(X),{me:!0}),t(me,{dense:"",borderless:"",rounded:"",modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=a=>c.value=a),autogrow:"",maxlength:"1024",label:e.$t("enter_reply"),class:"full-width enter-comment",disable:C.value,onKeydown:de(I,["enter"])},null,8,["modelValue","label","disable"]),t($,{icon:"send",class:"send-button",onClick:I,loading:C.value,disable:c.value.length==0},null,8,["loading","disable"])])])])])]),_:1})]),_:1},8,["onHide"]))}});export{Me as default};
