const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CommentComponent-t9q2FPfs.js","assets/CommentComponent.vue_vue_type_script_setup_true_lang-Bp1Fjw5N.js","assets/index-CW-_h3H6.js","assets/index-bp0Wj9ML.css","assets/QSpace-BLX8xWL2.js","assets/QMenu-Bmlm-oOs.js","assets/QScrollArea-BfWxh7rm.js","assets/QScrollObserver-B0ZGY-Hj.js","assets/format-CjHWdibf.js","assets/ReactionButtons.vue_vue_type_script_setup_true_lang-BiShpF7h.js","assets/MyButton.vue_vue_type_script_setup_true_lang-aOd0h3La.js","assets/i18n-CgE_7Bs0.js","assets/UserAvatar-CDRQ9fRO.js","assets/UserAvatar.vue_vue_type_script_setup_true_lang-gHrAtUti.js","assets/profile-store-DmI2gycK.js"])))=>i.map(i=>d[i]);
import{j as te,V as ae,E as r,W as ne,F as le,X as se,k as B,o as w,w as f,l as t,s as u,m as l,H as I,p as M,q as P,t as K,n as N,R as ie,Y as re,Z as me,Q as de,_ as T,$ as S,a0 as ce,a1 as ue}from"./index-CW-_h3H6.js";import{Q as U}from"./QSpace-BLX8xWL2.js";import{Q as ve}from"./QScrollArea-BfWxh7rm.js";import{_ as fe}from"./CloseableContent.vue_vue_type_script_setup_true_lang-CSTaD23l.js";import{_ as pe}from"./MyVirtualScroll.vue_vue_type_script_setup_true_lang--lf3OY7K.js";import{u as O}from"./use-dialog-plugin-component-C0eY4yAd.js";import{u as _e}from"./profile-store-DmI2gycK.js";import{a as j,_ as D}from"./MyButton.vue_vue_type_script_setup_true_lang-aOd0h3La.js";import{_ as he}from"./RectSkeleton.vue_vue_type_script_setup_true_lang-DcvU8W5z.js";import"./QScrollObserver-B0ZGY-Hj.js";const ge={class:"dialog-header",style:{"z-index":"2"}},ye={class:"horizontal-container label-container"},Ce={class:"dialog-content-inner"},be={class:"card dialog-section q-mb-sm",style:{"z-index":"2"}},ke={class:"horizontal-container"},we={key:1,class:"load-more-container"},De={class:"card send-comment"},Re={class:"card-section"},$e={class:"horizontal-container align-end full-width"},Be=te({__name:"RepliesDialog",props:{parentComment:{},comment:{},firstComment:{},autoLoad:{type:Boolean,default:!0},onDelete:{},inDialog:{type:Boolean,default:!0}},emits:[...O.emits],setup(F){var H;const R=K(()=>T(()=>import("./CommentComponent-t9q2FPfs.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),W=K(()=>T(()=>import("./UserAvatar-CDRQ9fRO.js"),__vite__mapDeps([12,13,2,3,14]))),d=F,X=_e(),s=ae(d.comment),V=r(Date.now()),i=r([]),m=r([]),$=r(!0),z=r(null),L=r(null),p=r(null),_=r(d.autoLoad);let q=!0,x,h=new AbortController;const c=r(((H=s.value._meta)==null?void 0:H.text)||""),g=r(!1);ne(c,()=>J("text",c.value));const{dialogRef:y,onDialogHide:Y}=O();function A(){_.value=!0,S(()=>{var e;(e=p.value)==null||e.checkLoading()})}function Z(e){$.value=e.position.top<z.value.scrollHeight+L.value.scrollHeight+66||e.direction=="up"}function G(){h.abort(),h=new AbortController,i.value=[],m.value=[],V.value=Date.now(),x=void 0,$.value=!0,_.value||A()}function J(e,o){var a;(a=s.value)._meta||(a._meta={}),s.value._meta[e]=o}async function ee(e,o){var C;const a=[];(C=m.value)!=null||(m.value=[]);try{if(m.value.length===0){const n=await ce(s.value.post_id,x,void 0,{signal:h.signal},s.value.comment_id),v=n.data.data.comments;if(q=n.data.data.has_more,x=n.data.data.next_cursor,n.data.success){const b=n.data.data.users;m.value.push(...v.map(k=>({...k,user:b[k.user_id]})))}}if(a.push(...m.value.splice(0,5)),a.length>0){const n=i.value;a.forEach(v=>{const b=n.findIndex(k=>k.comment_id===v.comment_id);b!==-1?n[b]=v:n.push(v)}),i.value=n}o(!(q||m.value.length>0))}catch(n){throw o(!0),n}}async function E(e){if(!(e instanceof KeyboardEvent&&e.shiftKey)){g.value=!0;try{const o=await ue(s.value.post_id,c.value,void 0,void 0,s.value.comment_id);if(o.data.success){const a={...o.data.data,user:await X.getProfile()};i.value.unshift(a),c.value="",s.value.replies_count+=1}}finally{g.value=!1,S(()=>{var o;return(o=p.value)==null?void 0:o.updateShowedItems(1)})}}}function Q(){var e;(e=y.value)==null||e.hide(),d.onDelete&&d.onDelete()}function oe(e){i.value=i.value.filter(o=>o.comment_id!==e),s.value.replies_count-=1,S(()=>{var o;return(o=p.value)==null?void 0:o.updateShowedItems()})}return le(()=>{d.firstComment&&i.value.push(d.firstComment)}),se(()=>{i.value=[],m.value=[],h.abort()}),(e,o)=>(w(),B(de,{"transition-show":"slide-up","transition-hide":"slide-down",class:"comment-dialog card-dialog",ref_key:"dialogRef",ref:y,onHide:u(Y),maximized:"",key:e.comment.comment_id},{default:f(()=>[t(fe,{onHide:o[2]||(o[2]=a=>u(y).hide())},{default:f(()=>[l("div",ge,[l("div",ye,[t(j,{icon:"chat_bubble",class:"header-icon"}),l("div",null,I(e.$t("comment")),1),t(U),t(D,{icon:"close",onClick:o[0]||(o[0]=a=>u(y).hide())})])]),l("div",Ce,[t(ve,{class:"scroll-area fix-scroll-area",visible:!1},{default:f(()=>[e.parentComment?(w(),M("div",{key:0,ref_key:"parentCommentComponentRef",ref:L,class:"q-mb-sm"},[t(u(R),{comment:e.parentComment,"in-dialog":d.inDialog,onDeleteComment:Q,"is-parent":"",style:{"z-index":"2"}},null,8,["comment","in-dialog"])],512)):P("",!0),l("div",{ref_key:"commentComponentRef",ref:z},[t(u(R),{comment:s.value,"in-dialog":d.inDialog,"in-replies-dialog":!0,onDeleteComment:Q,style:{"z-index":"2"}},null,8,["comment","in-dialog"])],512),l("div",{class:N(["sticky-label scroll-header q-pt-sm",{"is-visible":$.value}])},[l("div",be,[l("div",ke,[t(j,{icon:"reply",class:"icon"}),l("div",null,I(e.$t("replies")),1),t(U),t(D,{icon:"refresh",onClick:G})])])],2),(w(),B(pe,{items:i.value,margins:8,"item-key":"comment_id",onLoadMore:ee,onScroll:Z,"infinite-load-type":_.value?"bottom":"none",key:V.value,class:"posts-infinite-scroll",ref_key:"virtualScroll",ref:p,"skeleton-height":126,"no-items-key":"no_replies"},{default:f(({item:a,index:C})=>[t(u(R),{comment:a,class:N({"q-mb-sm":C+1<i.value.length}),onDeleteComment:oe,"in-dialog":e.inDialog,"hide-go-to":!0},null,8,["comment","class","in-dialog"])]),skeleton:f(()=>[t(he,{height:"126px",class:"card q-mb-sm"})]),_:1},8,["items","infinite-load-type"])),_.value?P("",!0):(w(),M("div",we,[t(D,{class:"load-more",type:"primary",onClick:A,"icon-right":"arrow_circle_down",label:e.$t("load_more")},null,8,["label"])]))]),_:1}),t(ie,{class:"q-mb-sm q-mt-sm"}),l("div",De,[l("div",Re,[l("div",$e,[t(u(W),{me:!0}),t(re,{dense:"",borderless:"",rounded:"",modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=a=>c.value=a),autogrow:"",maxlength:"1024",label:e.$t("enter_reply"),class:"full-width enter-comment",disable:g.value,onKeydown:me(E,["enter"])},null,8,["modelValue","label","disable"]),t(D,{icon:"send",class:"send-button",onClick:E,loading:g.value,disable:c.value.length==0},null,8,["loading","disable"])])])])])]),_:1})]),_:1},8,["onHide"]))}});export{Be as default};
