const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CategoryButtons-DyDrigRL.js","assets/CategoryButtons.vue_vue_type_script_setup_true_lang-CndfIUk0.js","assets/ClosePopup-DaR8jHqY.js","assets/index-CW-_h3H6.js","assets/index-bp0Wj9ML.css","assets/MyButton.vue_vue_type_script_setup_true_lang-aOd0h3La.js","assets/NotificationsList-CkLLrpbI.js","assets/format-CjHWdibf.js","assets/ProfileMenu-BYuz_mLo.js","assets/profile-store-DmI2gycK.js","assets/MySwitch.vue_vue_type_script_setup_true_lang-DAMlFWom.js","assets/UserAvatar.vue_vue_type_script_setup_true_lang-gHrAtUti.js","assets/OpenProfileMenu-BzoJcf8z.js","assets/QMenu-Bmlm-oOs.js","assets/QScrollArea-BfWxh7rm.js","assets/QScrollObserver-B0ZGY-Hj.js","assets/ParticlesBackground-CahmNlY9.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/ParticlesBackground-CdbJk_l4.css"])))=>i.map(i=>d[i]);
import{j as J,E as b,D as Y,W as Z,X as se,p as P,o as d,l as n,T as ee,w as _,k as N,aa as W,$ as ae,as as ne,at as ie,ad as le,u as re,h as v,F as ce,M as ue,au as de,av as pe,m as g,q as h,s as w,t as x,O as j,af as fe,H as U,n as F,_ as B}from"./index-CW-_h3H6.js";import{Q as me}from"./QMenu-Bmlm-oOs.js";import{Q as X}from"./QSpace-BLX8xWL2.js";import{Q as _e}from"./QPage-DzToCAIV.js";import{C as G}from"./ClosePopup-DaR8jHqY.js";import{Q as ve}from"./QScrollArea-BfWxh7rm.js";import{_ as ge}from"./MyVirtualScroll.vue_vue_type_script_setup_true_lang--lf3OY7K.js";import{_ as he}from"./RectSkeleton.vue_vue_type_script_setup_true_lang-DcvU8W5z.js";import{_ as we}from"./PostComponent.vue_vue_type_script_setup_true_lang-B2KNN0hS.js";import{_ as ye}from"./MainLayout.vue_vue_type_script_setup_true_lang-Cr9A2irR.js";import{_ as O,a as ke}from"./MyButton.vue_vue_type_script_setup_true_lang-aOd0h3La.js";import{_ as be}from"./MySelect.vue_vue_type_script_setup_true_lang-D3d6G_xz.js";import"./QScrollObserver-B0ZGY-Hj.js";import"./format-CjHWdibf.js";import"./i18n-CgE_7Bs0.js";import"./ReactionButtons.vue_vue_type_script_setup_true_lang-BiShpF7h.js";import"./MyChip.vue_vue_type_script_setup_true_lang-DpPNh9Tl.js";import"./QLayout-DAhnPVgp.js";import"./LogoComponent.vue_vue_type_script_setup_true_lang-Bd2ZGIhj.js";import"./CategoryButtons.vue_vue_type_script_setup_true_lang-CndfIUk0.js";const Se=J({__name:"PostScroll",props:{type:{}},emits:["scroll"],setup(H,{emit:z}){let y=new AbortController;const $=H,K=z,f=b([]),p=b($.type),m=[],l=[],r=[],L=b(null),S=["new","following","popular"];let T;const{t:V}=Y();Z(()=>$.type,k);function Q(){y.abort(),y=new AbortController,f.value=[],m.length=0,l.length=0,r.length=0,T=void 0}async function D(a,e=50){const s=[];for(;a.length>0;){const i=a.splice(0,e);s.push(ne(i))}await Promise.all(s)}function k(){Q(),p.value=`${$.type}-${Date.now()}`}async function A(a){const e=S.some(i=>i==a);!e&&m.length>0&&await D(m);const s=await ie(a,e?T:void 0,!e,{signal:y.signal});return s.data.success&&(T=s.data.data.next_cursor,l.push(...s.data.data.posts)),s.data}async function q(a){let e=l.slice(0,a);const s=async i=>{var C,t,o;let c;try{return c=await le(i,{signal:y.signal}),c.data.success&&r.push(...c.data.data.posts),null}catch(u){if(W(u)){const R=(o=(t=(C=u.response)==null?void 0:C.data)==null?void 0:t.data)==null?void 0:o.errors;if(R)return i.filter(te=>!R.some(oe=>oe.post===te))}throw u}};for(let i=0;i<a&&e.length!=0;i++){const c=await s(e);if(c===null)break;e=c}l.splice(0,a)}function E(a){if(a>r.length){const s=[...r];return r.length=0,s}const e=r.slice(-a);return r.splice(-a),e}async function M(a,e){var i,c,C,t;const s=f.value.length==0?Math.min(window.innerHeight/125+1,15):5;try{if(r.length==0&&l.length==0&&!(await A($.type)).success)return;if(r.length==0&&await q(s),r.length!=0){const o=E(s);f.value.push(...o);const u=o.map(R=>R.post_id);m.push(...u),f.value.length>=20&&m.length>=10&&D(m)}e()}catch(o){if(W(o)){if(o.code==="ERR_CANCELED"){e(!0);return}if(!o.response)throw e(!0),o;const u=((c=(i=o.response)==null?void 0:i.data)==null?void 0:c.error)=="NO_MORE_POSTS"?V("no_more_posts"):(t=(C=o.response)==null?void 0:C.data)==null?void 0:t.error.toLowerCase();f.value.push({is_system:!0,post_id:`${Date.now()}`,content:`<b>${V("an_error_occurred")}:</b> ${u}.
${V("try_reloading_feed")}.`,actions:[{name:"reload",icon:"refresh",func:()=>k()}]}),e(!0)}else throw o}}function I(a){f.value=f.value.filter(e=>e.post_id!==a),ae(()=>{var e;return(e=L.value)==null?void 0:e.updateShowedItems()})}return se(()=>{y.abort()}),(a,e)=>(d(),P("div",null,[n(ee,{name:"post-scroll"},{default:_(()=>[(d(),N(ve,{class:"scroll-area full-height",visible:!1,key:p.value},{default:_(()=>[n(ge,{items:f.value,margins:8,"item-key":"post_id","infinite-load-type":"bottom",class:"posts-infinite-scroll",onLoadMore:M,onScroll:e[0]||(e[0]=s=>K("scroll",s)),ref_key:"virtualScroll",ref:L,"skeleton-height":200},{default:_(({item:s})=>[n(we,{class:"q-mb-sm",post:s,onDeletePost:I},null,8,["post"])]),skeleton:_(()=>[n(he,{height:"200px",class:"card q-mb-sm","wait-time":1e3})]),_:1},8,["items"])]),_:1}))]),_:1})]))}}),Ce={class:"button-and-badge"},Pe={class:"horizontal-container"},$e={key:1,class:"button-badge"},Le={key:0,class:"left-column"},De={class:"card categories"},Ee={class:"center-column container",style:{gap:"0px"}},Ne={class:"full-height"},Te={key:1,class:"right-column"},Ve={class:"container right-column-content"},Ae={class:"card profile-menu"},Ie={key:0,class:"card notifications-list container"},xe={class:"label"},Be={key:0,class:"unread-count"},st=J({__name:"AppPage",setup(H){const z=x(()=>B(()=>import("./CategoryButtons-DyDrigRL.js"),__vite__mapDeps([0,1,2,3,4,5]))),y=x(()=>B(()=>import("./NotificationsList-CkLLrpbI.js"),__vite__mapDeps([6,3,4,7]))),$=x(()=>B(()=>import("./ProfileMenu-BYuz_mLo.js"),__vite__mapDeps([8,3,4,2,9,10,5,11]))),K=x(()=>B(()=>import("./OpenProfileMenu-BzoJcf8z.js"),__vite__mapDeps([12,3,4,13,14,15,5]))),f=x(()=>B(()=>import("./ParticlesBackground-CahmNlY9.js"),__vite__mapDeps([16,3,4,17,18]))),p=re(),{t:m}=Y(),l=b("popular"),r=b(Date.now()),L=b(!1),S=b([window.innerWidth,window.innerHeight]),T=v(()=>S.value[0]<=850),V=v(()=>S.value[0]>=1200),Q=v(()=>S.value[1]<=750),D=v(()=>!V.value),k=v(()=>T.value),A=v(()=>k.value||Q.value),q=v(()=>{let t=3;return D.value&&t--,k.value&&t--,t}),E=v(()=>p.getUnreadCount()),M=b(!1),I=t=>{l.value==t?r.value=Date.now():l.value=t};function a(t){M.value=t.position.top>8}const e=v(()=>[{icon:"whatshot",label:m("categories.popular"),click:()=>I("popular"),type:"popular"},{icon:"update",label:m("categories.new"),click:()=>I("new"),type:"new"},{icon:"group",label:m("categories.following"),click:()=>I("following"),type:"following"}]),s=[{labelKey:"categories.popular",icon:"whatshot",key:"popular"},{labelKey:"categories.new",icon:"update",key:"new"},{labelKey:"categories.following",icon:"group",key:"following"}],i=()=>{S.value[0]=window.innerWidth,S.value[1]=window.innerHeight};function c(){p.openDialog("notifications","",{})}Z(l,t=>{localStorage.setItem("lastSelectedType",t)});async function C(){var t;await Notification.requestPermission(),(t=p.openedDialogs.get("okCancel"))==null||t.hide()}return ce(()=>{i(),window.addEventListener("resize",i,{passive:!0}),Notification.permission=="default"&&p.getSetting("getNotifications")===void 0&&p.openDialog("okCancel","",{localeKey:"notification_permission",okKey:"yes",cancelKey:"no"},()=>void C(),()=>p.setSettings("getNotifications",!1))}),ue(()=>{window.removeEventListener("resize",i)}),de(()=>{const t=localStorage.getItem("lastSelectedType");t&&e.value.find(o=>o.type===t)&&(l.value=t)}),(t,o)=>(d(),N(ye,{"in-router":!1,"headers-class":"index-10",class:"full-height"},pe({default:_(()=>[w(p).getSetting("starBackground")?(d(),N(w(f),{key:0})):h("",!0),n(_e,{class:F(["app-page",`columns-${q.value}`])},{default:_(()=>[D.value?h("",!0):(d(),P("div",Le,[g("div",De,[n(w(z),{"categories-list":e.value,"current-type":l.value},null,8,["categories-list","current-type"])])])),g("div",Ee,[D.value?(d(),P("div",{key:0,class:F(["horizontal-container categories-label card",{scrolled:M.value}])},[n(be,{options:s,modelValue:l.value,"onUpdate:modelValue":o[3]||(o[3]=u=>l.value=u)},null,8,["modelValue"]),n(X),n(O,{icon:"refresh",class:"reload-button",onClick:o[4]||(o[4]=u=>r.value=Date.now())})],2)):h("",!0),g("div",Ne,[n(ee,{name:"post-scroll"},{default:_(()=>[(d(),N(Se,{type:l.value,key:r.value,class:"full-height full-width",onScroll:a},null,8,["type"]))]),_:1})])]),k.value?h("",!0):(d(),P("div",Te,[g("div",Ve,[g("div",Ae,[n(w($),{"buttons-class":"card-button"})]),A.value?h("",!0):(d(),P("div",Ie,[g("div",{class:"label-container horizontal-container card",onClick:c},[n(ke,{icon:"notifications",class:"icon"}),g("div",xe,U(t.$t("notifications.label")),1),E.value>0?(d(),P("span",Be,U(E.value),1)):h("",!0),n(X),n(O,{icon:"expand_content",onClick:c})]),n(w(y))]))])]))]),_:1},8,["class"])]),_:2},[k.value||A.value?{name:"toolbar-actions",fn:_(()=>[g("div",Ce,[A.value?(d(),N(O,{key:0,icon:"notifications",class:"webkit-no-drag"},{default:_(()=>[n(me,{class:"menu-card notifications-menu",modelValue:L.value,"onUpdate:modelValue":o[2]||(o[2]=u=>L.value=u),"max-height":"999px"},{default:_(()=>[n(w(y),{onOnLoaded:o[0]||(o[0]=u=>L.value=!1)}),g("div",Pe,[j(n(O,{icon:"expand_content",type:"primary",label:t.$t("show_all"),class:"full-width q-mt-sm centered",onClick:c},null,8,["label"]),[[G]]),j(n(O,{icon:"mark_chat_read",type:"outlined",label:t.$t("read_all"),class:"full-width q-mt-sm centered",onClick:o[1]||(o[1]=()=>void w(fe)()),disable:w(p).unreadCount==0},null,8,["label","disable"]),[[G]])])]),_:1},8,["modelValue"])]),_:1})):h("",!0),E.value>0?(d(),P("span",$e,U(E.value),1)):h("",!0)]),k.value?(d(),N(w(K),{key:0})):h("",!0)]),key:"0"}:void 0]),1024))}});export{st as default};
