import{Q as S}from"./QSpace-DJsL9YqM.js";import{Q as V}from"./QScrollArea-Dq0GnGzl.js";import{j as z,aK as A,E as c,aL as D,X as E,p as I,o as C,m as h,l as s,w as v,k as L,n as Q,G as U,aM as q,$ as N}from"./index-Do0CBbdm.js";import{_ as j}from"./MyVirtualScroll.vue_vue_type_script_setup_true_lang-zwac-2S7.js";import{_ as M}from"./MyButton.vue_vue_type_script_setup_true_lang-0geFim1q.js";import{_ as F}from"./MySelect.vue_vue_type_script_setup_true_lang-BDrcWKEP.js";import{_ as G}from"./RectSkeleton.vue_vue_type_script_setup_true_lang-CpUe4OqW.js";import{_ as O}from"./PostComponent.vue_vue_type_script_setup_true_lang-BXiaNLWl.js";import"./QScrollObserver-VymQKE2s.js";import"./QMenu-VlGd84cI.js";import"./CategoryButtons.vue_vue_type_script_setup_true_lang-Db63KgFB.js";import"./ClosePopup-uR4tGjqj.js";import"./format-BFOA4BKc.js";import"./i18n-DwXAnslu.js";import"./ReactionButtons.vue_vue_type_script_setup_true_lang-x7LFGFb4.js";import"./MyChip.vue_vue_type_script_setup_true_lang-b99PVErD.js";const T={class:"card q-mb-sm dialog-section",style:{"z-index":"2"}},X={class:"horizontal-container"},H={class:"horizontal-container",style:{gap:"0"}},ue=z({__name:"UserPosts",props:A({user:{},meta:{}},{expand:{type:Boolean},expandModifiers:{}}),emits:["update:expand"],setup(x){const g=x;let m,y=!0;const k=c(null),l=D(x,"expand"),o=c([]),n=c([]),w=c(Date.now()),$=[{labelKey:"sort.old",icon:"history_2",key:"old"},{labelKey:"sort.new",icon:"update",key:"new"},{labelKey:"sort.popular",icon:"whatshot",key:"popular"}],p=c("new");let d=new AbortController;function B(){l.value||(l.value=!1),l.value=!l.value}function b(){d.abort(),d=new AbortController,o.value=[],n.value=[],m=void 0,w.value=Date.now()}async function K(f,e){const r=o.value.length==0?10:5;try{const a=[];if(n.value.length===0){const t=await q(g.user.user_id,m,p.value,{signal:d.signal}),i=t.data.data.posts;if(y=t.data.data.has_more,m=t.data.data.next_cursor,t.data.success){const u=i.map(_=>({..._,user:g.user}));n.value.push(...u)}}if(a.push(...n.value.splice(0,r)),a.length>0){const t=[...o.value];a.forEach(i=>{const u=t.findIndex(_=>_.post_id===i.post_id);u!==-1?t[u]=i:t.push(i)}),o.value=t}e(!(y||n.value.length>0))}catch(a){throw e(!0),a}}function P(f){o.value=o.value.filter(e=>e.post_id!==f),N(()=>{var e;return(e=k.value)==null?void 0:e.updateShowedItems()})}return E(()=>{d.abort()}),(f,e)=>(C(),I(U,null,[h("div",T,[h("div",X,[s(F,{class:"select",modelValue:p.value,"onUpdate:modelValue":[e[0]||(e[0]=r=>p.value=r),b],options:$,style:{"min-width":"100px",width:"150px","max-width":"300px"}},null,8,["modelValue"]),s(S),h("div",H,[s(M,{icon:l.value?"collapse_content":"expand_content",onClick:B},null,8,["icon"]),s(M,{icon:"refresh",onClick:b})])])]),s(V,{class:"scroll-area full-height fix-scroll-area",visible:!1},{default:v(()=>[(C(),L(j,{items:o.value,margins:8,"item-key":"post_id",onLoadMore:K,"infinite-load-type":"bottom",key:w.value,ref_key:"virtualScroll",ref:k,"skeleton-height":200},{default:v(({item:r,index:a})=>[s(O,{post:r,class:Q({"q-mb-sm":a+1<o.value.length}),onDeletePost:P},null,8,["post","class"])]),skeleton:v(()=>[s(G,{height:"200px",class:"card q-mb-sm"})]),_:1},8,["items"]))]),_:1})],64))}});export{ue as default};
