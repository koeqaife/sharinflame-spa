const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CommentComponent-CRWLtl5h.js","assets/CommentComponent.vue_vue_type_script_setup_true_lang-DEIzHHbG.js","assets/index-Do0CBbdm.js","assets/index-DI-gpe9-.css","assets/QSpace-DJsL9YqM.js","assets/QMenu-VlGd84cI.js","assets/QScrollArea-Dq0GnGzl.js","assets/QScrollObserver-VymQKE2s.js","assets/format-BFOA4BKc.js","assets/ReactionButtons.vue_vue_type_script_setup_true_lang-x7LFGFb4.js","assets/MyButton.vue_vue_type_script_setup_true_lang-0geFim1q.js","assets/i18n-DwXAnslu.js","assets/UserAvatar-DHdL_HDj.js","assets/UserAvatar.vue_vue_type_script_setup_true_lang-Cq6qoxMd.js","assets/profile-store-DKzKeDwC.js"])))=>i.map(i=>d[i]);
import{j as ae,E as r,V as te,W as le,F as ne,X as se,k as H,o as D,w as _,l as a,s as u,m as n,H as R,p as I,q as M,t as P,n as K,R as ie,Y as re,Z as de,Q as ce,_ as N,$ as V,a0 as me,a1 as ue}from"./index-Do0CBbdm.js";import{Q as T}from"./QSpace-DJsL9YqM.js";import{Q as ve}from"./QScrollArea-Dq0GnGzl.js";import{_ as fe}from"./CloseableContent.vue_vue_type_script_setup_true_lang-mxmVnD-k.js";import{_ as _e}from"./MyVirtualScroll.vue_vue_type_script_setup_true_lang-zwac-2S7.js";import{u as U}from"./use-dialog-plugin-component-5oIaZXWZ.js";import{u as pe}from"./profile-store-DKzKeDwC.js";import{a as O,_ as $}from"./MyButton.vue_vue_type_script_setup_true_lang-0geFim1q.js";import{_ as he}from"./RectSkeleton.vue_vue_type_script_setup_true_lang-CpUe4OqW.js";import"./QScrollObserver-VymQKE2s.js";const ge={class:"dialog-header",style:{"z-index":"2"}},ye={class:"horizontal-container label-container"},be={class:"dialog-content-inner"},Ce={class:"card dialog-section q-mb-sm",style:{"z-index":"2"}},we={class:"horizontal-container"},ke={key:0,class:"no-comments"},De={key:1,class:"load-more-container"},$e={class:"card send-comment"},xe={class:"card-section"},Se={class:"horizontal-container align-end full-width"},Ie=ae({__name:"RepliesDialog",props:{comment:{},firstComment:{},autoLoad:{type:Boolean,default:!0},onDelete:{},inDialog:{type:Boolean,default:!0}},emits:[...U.emits],setup(j){var B;const L=P(()=>N(()=>import("./CommentComponent-CRWLtl5h.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),F=P(()=>N(()=>import("./UserAvatar-DHdL_HDj.js"),__vite__mapDeps([12,13,2,3,14]))),c=j,v=r(!1),W=pe(),i=te(c.comment),z=r(Date.now()),s=r([]),d=r([]),x=r(!0),A=r(null),p=r(null),h=r(c.autoLoad);let E=!0,S,g=new AbortController;const m=r(((B=i.value._meta)==null?void 0:B.text)||""),y=r(!1);le(m,()=>G("text",m.value));const{dialogRef:b,onDialogHide:X}=U();function Q(){h.value=!0,V(()=>{var e;(e=p.value)==null||e.checkLoading()})}function Y(e){x.value=e.position.top<A.value.scrollHeight+66||e.direction=="up"}function Z(){g.abort(),g=new AbortController,v.value=!1,s.value=[],d.value=[],z.value=Date.now(),S=void 0,x.value=!0,h.value||Q()}function G(e,o){var t;(t=i.value)._meta||(t._meta={}),i.value._meta[e]=o}async function J(e,o){var C;v.value=!1;const t=[];(C=d.value)!=null||(d.value=[]);try{if(d.value.length===0){const l=await me(i.value.post_id,S,void 0,{signal:g.signal},i.value.comment_id),f=l.data.data.comments;if(E=l.data.data.has_more,S=l.data.data.next_cursor,l.data.success){const w=l.data.data.users;d.value.push(...f.map(k=>({...k,user:w[k.user_id]})))}}if(t.push(...d.value.splice(0,5)),t.length>0){const l=s.value;t.forEach(f=>{const w=l.findIndex(k=>k.comment_id===f.comment_id);w!==-1?l[w]=f:l.push(f)}),s.value=l}o(!(E||d.value.length>0))}catch(l){throw o(!0),l}finally{s.value.length==0&&(v.value=!0)}}async function q(e){if(!(e instanceof KeyboardEvent&&e.shiftKey)){y.value=!0;try{const o=await ue(i.value.post_id,m.value,void 0,void 0,i.value.comment_id);if(o.data.success){const t={...o.data.data,user:await W.getProfile()};s.value.unshift(t),m.value="",i.value.replies_count+=1}}finally{v.value=!1,y.value=!1,V(()=>{var o;return(o=p.value)==null?void 0:o.updateShowedItems(1)})}}}function ee(){var e;(e=b.value)==null||e.hide(),c.onDelete&&c.onDelete()}function oe(e){s.value=s.value.filter(o=>o.comment_id!==e),i.value.replies_count-=1,V(()=>{var o;return(o=p.value)==null?void 0:o.updateShowedItems()})}return ne(()=>{c.firstComment&&s.value.push(c.firstComment)}),se(()=>{s.value=[],d.value=[],g.abort()}),(e,o)=>(D(),H(ce,{"transition-show":"slide-up","transition-hide":"slide-down",class:"comment-dialog card-dialog",ref_key:"dialogRef",ref:b,onHide:u(X),maximized:"",key:e.comment.comment_id},{default:_(()=>[a(fe,{onHide:o[2]||(o[2]=t=>u(b).hide())},{default:_(()=>[n("div",ge,[n("div",ye,[a(O,{icon:"chat_bubble",class:"header-icon"}),n("div",null,R(e.$t("comment")),1),a(T),a($,{icon:"close",onClick:o[0]||(o[0]=t=>u(b).hide())})])]),n("div",be,[a(ve,{class:"scroll-area fix-scroll-area",visible:!1},{default:_(()=>[n("div",{ref_key:"commentComponentRef",ref:A},[a(u(L),{comment:i.value,"in-dialog":c.inDialog,"in-replies-dialog":!0,onDeleteComment:ee,style:{"z-index":"2"}},null,8,["comment","in-dialog"])],512),n("div",{class:K(["sticky-label scroll-header q-pt-sm",{"is-visible":x.value}])},[n("div",Ce,[n("div",we,[a(O,{icon:"reply",class:"icon"}),n("div",null,R(e.$t("replies")),1),a(T),a($,{icon:"refresh",onClick:Z})])])],2),v.value?(D(),I("div",ke,R(e.$t("no_replies")),1)):M("",!0),(D(),H(_e,{items:s.value,margins:8,"item-key":"comment_id",onLoadMore:J,onScroll:Y,"infinite-load-type":h.value?"bottom":"none",key:z.value,class:"posts-infinite-scroll",ref_key:"virtualScroll",ref:p,"skeleton-height":126},{default:_(({item:t,index:C})=>[a(u(L),{comment:t,class:K({"q-mb-sm":C+1<s.value.length}),onDeleteComment:oe,"in-dialog":e.inDialog,"hide-go-to":!0},null,8,["comment","class","in-dialog"])]),skeleton:_(()=>[a(he,{height:"126px",class:"card q-mb-sm"})]),_:1},8,["items","infinite-load-type"])),h.value?M("",!0):(D(),I("div",De,[a($,{class:"load-more",type:"primary",onClick:Q,"icon-right":"arrow_circle_down",label:e.$t("load_more")},null,8,["label"])]))]),_:1}),a(ie,{class:"q-mb-sm q-mt-sm"}),n("div",$e,[n("div",xe,[n("div",Se,[a(u(F),{me:!0}),a(re,{dense:"",borderless:"",rounded:"",modelValue:m.value,"onUpdate:modelValue":o[1]||(o[1]=t=>m.value=t),autogrow:"",maxlength:"1024",label:e.$t("enter_reply"),class:"full-width enter-comment",disable:y.value,onKeydown:de(q,["enter"])},null,8,["modelValue","label","disable"]),a($,{icon:"send",class:"send-button",onClick:q,loading:y.value,disable:m.value.length==0},null,8,["loading","disable"])])])])])]),_:1})]),_:1},8,["onHide"]))}});export{Ie as default};
